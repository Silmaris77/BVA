<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milwaukee Lesson 3: Negotiations & Closing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            color: #212121;
            line-height: 1.6;
        }

        .lesson-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .lesson-header {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(211, 47, 47, 0.3);
        }

        .lesson-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .lesson-subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .lesson-meta {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .meta-icon {
            font-size: 1.5rem;
        }

        /* Progress Bar */
        .progress-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .progress-label {
            font-weight: 600;
            color: #212121;
        }

        .progress-xp {
            font-weight: 700;
            color: #D32F2F;
            font-size: 1.1rem;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #D32F2F 0%, #FF5252 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            display: none;
        }

        .card.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            margin-bottom: 30px;
        }

        .card-number {
            display: inline-block;
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 2rem;
            color: #212121;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .card-header p {
            color: #666;
            font-size: 1.1rem;
        }

        /* Video Section */
        .video-container {
            margin: 30px 0;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-checkpoint {
            margin-top: 25px;
            padding: 20px;
            background: #E8F5E9;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .checkpoint-checkbox {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .checkpoint-checkbox input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .checkpoint-checkbox label {
            font-size: 1.05rem;
            font-weight: 600;
            color: #2E7D32;
            cursor: pointer;
        }

        .reflection-area {
            margin-top: 20px;
        }

        .reflection-area label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #212121;
        }

        .reflection-area textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
        }

        .reflection-area textarea:focus {
            outline: none;
            border-color: #D32F2F;
        }

        .key-points {
            background: #FFF3E0;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
        }

        .key-points h3 {
            color: #E65100;
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .key-points ol {
            margin-left: 20px;
        }

        .key-points li {
            margin-bottom: 15px;
            line-height: 1.7;
            color: #212121;
        }

        .key-points li strong {
            color: #D32F2F;
        }

        /* ZOPA Framework */
        .zopa-diagram {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }

        .zopa-visual {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .zopa-side {
            flex: 1;
            padding: 20px;
        }

        .zopa-side h4 {
            color: #D32F2F;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .zopa-side p {
            margin: 8px 0;
            font-size: 0.95rem;
        }

        .zopa-zone {
            flex: 0 0 200px;
            padding: 30px 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.5rem;
            text-align: center;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin: 30px 0;
        }

        .concept-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .concept-card h4 {
            color: #D32F2F;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .concept-card p {
            line-height: 1.7;
            color: #212121;
            margin-bottom: 10px;
        }

        .concept-card .rule {
            background: #FFF3E0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            font-weight: 600;
            color: #E65100;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .weak {
            background: #FFEBEE;
        }

        .strong {
            background: #E8F5E9;
        }

        /* Insight Box */
        .insight-box {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border-left: 4px solid #FF9800;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }

        .insight-box strong {
            color: #E65100;
        }

        /* Success Message */
        .success-message {
            background: #C8E6C9;
            color: #2E7D32;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            font-weight: 600;
        }

        .success-message.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navigation */
        .card-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        .nav-button {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3);
        }

        .nav-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(211, 47, 47, 0.4);
        }

        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-prev {
            background: linear-gradient(135deg, #757575 0%, #616161 100%);
        }

        /* Badge Overlay */
        .badge-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .badge-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .badge-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .badge-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .badge-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .badge-title {
            font-size: 2.5rem;
            color: #D32F2F;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .badge-subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        .badge-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .badge-stat {
            text-align: center;
        }

        .badge-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #D32F2F;
        }

        .badge-stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .badge-message {
            line-height: 1.8;
            color: #212121;
            margin: 25px 0;
        }

        .badge-btn {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Negotiation Simulator */
        .scenario-container {
            margin: 30px 0;
        }

        .scenario-box {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .scenario-number {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .scenario-status {
            font-size: 1.5rem;
        }

        .scenario-situation {
            background: #E3F2FD;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #1976D2;
        }

        .scenario-situation strong {
            color: #1565C0;
        }

        .scenario-options {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 18px 20px;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: #D32F2F;
            background: #FFEBEE;
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: #C8E6C9;
            border-color: #4CAF50;
        }

        .option-btn.incorrect {
            background: #FFCDD2;
            border-color: #F44336;
        }

        .option-btn.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-letter {
            font-weight: 700;
            color: #D32F2F;
            min-width: 30px;
        }

        .option-btn.correct .option-letter {
            color: #2E7D32;
        }

        .option-btn.incorrect .option-letter {
            color: #C62828;
        }

        .scenario-feedback {
            background: #FFF3E0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #FF9800;
            display: none;
            margin-top: 15px;
        }

        .scenario-feedback.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .scenario-feedback.correct {
            background: #E8F5E9;
            border-left-color: #4CAF50;
        }

        .scenario-feedback.incorrect {
            background: #FFEBEE;
            border-left-color: #F44336;
        }

        .scenario-feedback h4 {
            margin-bottom: 10px;
            color: #E65100;
        }

        .scenario-feedback.correct h4 {
            color: #2E7D32;
        }

        .scenario-feedback.incorrect h4 {
            color: #C62828;
        }

        .score-display {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .score-display.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .score-value {
            font-size: 4rem;
            font-weight: 700;
            margin: 20px 0;
        }

        .score-interpretation {
            font-size: 1.3rem;
            margin-top: 15px;
            opacity: 0.95;
        }

        /* Value Stacking */
        .value-builder {
            margin: 30px 0;
        }

        .scenario-intro {
            background: #FFEBEE;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #D32F2F;
            margin-bottom: 30px;
        }

        .scenario-intro h3 {
            color: #C62828;
            margin-bottom: 15px;
        }

        .scenario-intro .problem {
            font-size: 1.3rem;
            font-weight: 700;
            color: #D32F2F;
            margin: 15px 0;
        }

        .value-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .value-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .value-option:hover {
            border-color: #D32F2F;
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.2);
        }

        .value-option.selected {
            border-color: #4CAF50;
            background: #E8F5E9;
        }

        .value-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .value-checkbox input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            margin-top: 3px;
        }

        .value-name {
            font-weight: 700;
            color: #212121;
            font-size: 1.1rem;
        }

        .value-metrics {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 0.9rem;
        }

        .metric {
            display: flex;
            flex-direction: column;
        }

        .metric-label {
            color: #666;
            font-size: 0.85rem;
        }

        .metric-value {
            font-weight: 700;
            color: #D32F2F;
        }

        .metric-value.green {
            color: #4CAF50;
        }

        .value-description {
            color: #666;
            line-height: 1.6;
            margin-top: 10px;
            font-size: 0.95rem;
        }

        .calculator-results {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .result-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .result-label {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2E7D32;
        }

        .result-value.ratio {
            color: #D32F2F;
        }

        .generated-statement {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .generated-statement h4 {
            color: #2E7D32;
            margin-bottom: 15px;
        }

        .generated-statement p {
            line-height: 1.8;
            color: #212121;
        }

        .save-button {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
            margin-top: 20px;
        }

        .save-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(76, 175, 80, 0.4);
        }

        .save-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Flashcards */
        .flashcards-container {
            margin: 30px 0;
        }

        .flashcards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .flashcard {
            perspective: 1000px;
            height: 350px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
        }

        .flashcard-front {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            color: white;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .flashcard-back {
            background: white;
            transform: rotateY(180deg);
            overflow-y: auto;
        }

        .flashcard-number {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .flashcard-front h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .flashcard-front p {
            font-size: 1rem;
            opacity: 0.95;
            line-height: 1.6;
        }

        .flip-hint {
            position: absolute;
            bottom: 15px;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .flashcard-back h4 {
            color: #D32F2F;
            font-size: 1.1rem;
            margin-bottom: 10px;
            margin-top: 15px;
        }

        .flashcard-back h4:first-child {
            margin-top: 0;
        }

        .flashcard-back p {
            color: #212121;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .flashcard-back .script {
            background: #E3F2FD;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #1976D2;
            font-style: italic;
            margin: 10px 0;
        }

        .flashcard-back .example {
            background: #E8F5E9;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
            margin: 10px 0;
        }

        .flashcard-back .warning {
            background: #FFF3E0;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #FF9800;
            margin: 10px 0;
        }

        .flashcard-progress {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 25px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .flashcard-progress h3 {
            color: #212121;
            margin-bottom: 15px;
        }

        .progress-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #D32F2F;
            margin: 10px 0;
        }

        .flashcard-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .flashcard-btn {
            background: linear-gradient(135deg, #757575 0%, #616161 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .flashcard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .flashcard-btn.primary {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
        }

        /* Contract Checklist */
        .contract-checklist {
            margin: 30px 0;
        }

        .contract-intro {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #1976D2;
        }

        .contract-intro h3 {
            color: #1565C0;
            margin-bottom: 15px;
        }

        .contract-term {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .term-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f5f5f5;
        }

        .term-number {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .term-title {
            flex: 1;
            margin-left: 15px;
        }

        .term-title h4 {
            color: #212121;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .term-description {
            color: #666;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .term-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .term-option {
            position: relative;
        }

        .term-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .term-option label {
            display: block;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
        }

        .term-option input[type="radio"]:checked + label {
            background: #E8F5E9;
            border-color: #4CAF50;
            color: #2E7D32;
        }

        .term-option label:hover {
            border-color: #D32F2F;
            background: #FFEBEE;
        }

        .option-label {
            display: block;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .option-description {
            font-size: 0.85rem;
            font-weight: 400;
            color: #666;
        }

        .leverage-box {
            background: #FFF3E0;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #FF9800;
            margin-bottom: 15px;
        }

        .leverage-box h5 {
            color: #E65100;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .leverage-box p {
            color: #212121;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .term-notes {
            margin-top: 15px;
        }

        .term-notes label {
            display: block;
            font-weight: 600;
            color: #212121;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .term-notes textarea {
            width: 100%;
            min-height: 60px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            resize: vertical;
        }

        .term-notes textarea:focus {
            outline: none;
            border-color: #D32F2F;
        }

        .balance-score {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }

        .balance-score h3 {
            color: #2E7D32;
            margin-bottom: 20px;
        }

        .score-bars {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            align-items: center;
        }

        .score-bar {
            flex: 1;
            text-align: center;
        }

        .score-bar h4 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .score-bar .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #D32F2F;
        }

        .score-bar.client .value {
            color: #1976D2;
        }

        .score-bar.neutral .value {
            color: #757575;
        }

        .score-bar.vendor .value {
            color: #D32F2F;
        }

        .balance-interpretation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .balance-interpretation p {
            color: #212121;
            line-height: 1.7;
            font-size: 1rem;
        }

        .balance-interpretation .target {
            background: #E8F5E9;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
            margin-top: 15px;
            font-weight: 600;
            color: #2E7D32;
        }

        /* Role-Play Simulator */
        .roleplay-container {
            margin: 30px 0;
        }

        .roleplay-scenario {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4CAF50;
        }

        .roleplay-scenario h3 {
            color: #2E7D32;
            margin-bottom: 15px;
        }

        .roleplay-scenario .stakeholders {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .stakeholder {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 10px 0;
            font-size: 0.95rem;
        }

        .stakeholder-icon {
            font-size: 1.5rem;
        }

        .conversation {
            margin: 30px 0;
        }

        .turn-header {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .turn-number {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .current-score {
            font-size: 1.2rem;
        }

        .quote-bubble {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .quote-bubble::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid white;
        }

        .quote-speaker {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f5f5f5;
        }

        .speaker-icon {
            font-size: 2rem;
        }

        .speaker-info h4 {
            color: #D32F2F;
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        .speaker-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .quote-text {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #212121;
            font-style: italic;
        }

        .context-note {
            background: #FFF3E0;
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #E65100;
            border-left: 3px solid #FF9800;
        }

        .choice-options {
            display: grid;
            gap: 15px;
            margin: 25px 0;
        }

        .choice-btn {
            background: white;
            border: 3px solid #e0e0e0;
            padding: 20px;
            border-radius: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .choice-btn:hover:not(.disabled) {
            border-color: #D32F2F;
            background: #FFEBEE;
            transform: translateX(8px);
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.2);
        }

        .choice-btn.selected {
            border-color: #4CAF50;
            background: #E8F5E9;
        }

        .choice-btn.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .choice-letter {
            font-size: 1.5rem;
            font-weight: 700;
            color: #D32F2F;
            min-width: 35px;
        }

        .choice-btn.selected .choice-letter {
            color: #2E7D32;
        }

        .choice-content {
            flex: 1;
        }

        .choice-text {
            font-size: 1.05rem;
            line-height: 1.6;
            color: #212121;
            margin-bottom: 8px;
        }

        .choice-impact {
            font-size: 0.85rem;
            color: #666;
            font-style: italic;
        }

        .turn-feedback {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            border-left: 4px solid #1976D2;
            display: none;
        }

        .turn-feedback.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .turn-feedback h4 {
            color: #1565C0;
            margin-bottom: 12px;
        }

        .turn-feedback p {
            color: #212121;
            line-height: 1.7;
        }

        .score-change {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 700;
            margin-left: 10px;
        }

        .next-turn-btn {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3);
        }

        .next-turn-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(211, 47, 47, 0.4);
        }

        .roleplay-end {
            background: white;
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            text-align: center;
            display: none;
        }

        .roleplay-end.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .final-score {
            font-size: 4rem;
            font-weight: 700;
            color: #D32F2F;
            margin: 20px 0;
        }

        .final-score.excellent {
            color: #4CAF50;
        }

        .final-score.good {
            color: #FF9800;
        }

        .final-score.weak {
            color: #F44336;
        }

        .score-label {
            font-size: 2rem;
            color: #212121;
            margin-bottom: 20px;
        }

        .outcome-message {
            background: #E8F5E9;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            line-height: 1.8;
            color: #212121;
        }

        .path-review {
            background: #F5F5F5;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            text-align: left;
        }

        .path-review h4 {
            color: #D32F2F;
            margin-bottom: 15px;
        }

        .path-step {
            margin: 12px 0;
            padding-left: 20px;
            border-left: 3px solid #D32F2F;
        }

        /* Post-Negotiation Email Builder */
        .postneg-intro {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4CAF50;
        }

        .checklist-90day {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .checklist-90day h3 {
            color: #D32F2F;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist-phase {
            margin: 20px 0;
            padding: 15px;
            background: #F5F5F5;
            border-radius: 8px;
            border-left: 4px solid #D32F2F;
        }

        .checklist-phase h4 {
            color: #D32F2F;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .checklist-item:hover {
            background: #FFEBEE;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checklist-item label {
            flex: 1;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .checklist-item.completed {
            opacity: 0.6;
        }

        .checklist-item.completed label {
            text-decoration: line-through;
            color: #666;
        }

        .checklist-progress {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }

        .checklist-progress-bar {
            background: #E0E0E0;
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .checklist-progress-fill {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .email-builder {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .email-builder h3 {
            color: #D32F2F;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .template-selector {
            margin: 20px 0;
        }

        .template-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #212121;
        }

        .template-selector select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-selector select:focus {
            border-color: #D32F2F;
            outline: none;
        }

        .placeholder-inputs {
            display: grid;
            gap: 15px;
            margin: 25px 0;
            display: none;
        }

        .placeholder-inputs.show {
            display: grid;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-group label {
            font-weight: 600;
            color: #212121;
            font-size: 0.95rem;
        }

        .input-group input,
        .input-group textarea {
            padding: 10px 12px;
            font-size: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            border-color: #D32F2F;
            outline: none;
        }

        .email-preview {
            background: #F5F5F5;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
            border: 2px solid #e0e0e0;
            display: none;
        }

        .email-preview.show {
            display: block;
        }

        .email-preview h4 {
            color: #D32F2F;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .email-preview-subject {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .email-preview-subject strong {
            color: #666;
            font-size: 0.9rem;
        }

        .email-preview-body {
            background: white;
            padding: 20px;
            border-radius: 6px;
            line-height: 1.8;
            white-space: pre-wrap;
            font-family: Arial, sans-serif;
            font-size: 0.95rem;
        }

        .placeholder-missing {
            background: #FFF3E0;
            color: #E65100;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .email-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .email-btn {
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .email-btn.copy {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            color: white;
        }

        .email-btn.copy:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(25, 118, 210, 0.3);
        }

        .email-btn.mark-sent {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
        }

        .email-btn.mark-sent:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }

        .email-btn.mark-sent:disabled {
            background: #E0E0E0;
            color: #999;
            cursor: not-allowed;
        }

        .email-btn.reset {
            background: white;
            border: 2px solid #D32F2F;
            color: #D32F2F;
        }

        .email-btn.reset:hover {
            background: #FFEBEE;
        }

        .copy-feedback {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .copy-feedback.show {
            opacity: 1;
        }

        /* Summary Card */
        .summary-container {
            margin: 30px 0;
        }

        .summary-intro {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4CAF50;
            text-align: center;
        }

        .summary-intro h3 {
            color: #2E7D32;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .summary-intro p {
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .learning-checklist {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .learning-checklist h3 {
            color: #D32F2F;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .learning-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: #F5F5F5;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .learning-item-icon {
            font-size: 1.5rem;
            min-width: 30px;
        }

        .learning-item-content {
            flex: 1;
        }

        .learning-item-content strong {
            color: #D32F2F;
            font-size: 1.05rem;
        }

        .learning-item-content p {
            margin-top: 5px;
            color: #666;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .stat-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #D32F2F;
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #D32F2F;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badge-reveal-btn {
            background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%);
            color: white;
            padding: 20px 50px;
            border: none;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            margin: 30px auto;
            display: block;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
        }

        .badge-reveal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(211, 47, 47, 0.5);
        }

        .badge-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        .badge-overlay.show {
            display: flex;
        }

        .badge-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            max-width: 600px;
            text-align: center;
            position: relative;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .badge-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

        .badge-close:hover {
            color: #D32F2F;
        }

        .badge-icon {
            font-size: 6rem;
            margin: 20px 0;
            animation: bounceIn 0.8s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .badge-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #D32F2F;
            margin: 20px 0;
        }

        .badge-message {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #212121;
            margin: 20px 0;
        }

        .next-lesson-cta {
            background: #E0E0E0;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
            opacity: 0.6;
        }

        .next-lesson-cta h4 {
            color: #666;
            margin-bottom: 10px;
        }

        .next-lesson-cta p {
            color: #999;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .lesson-title {
                font-size: 1.8rem;
            }

            .card {
                padding: 25px;
            }

            .card-title {
                font-size: 1.5rem;
            }

            .nav-button {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .lesson-meta {
                gap: 15px;
            }

            .badge-content {
                width: 90%;
                padding: 30px;
            }

            .badge-icon {
                font-size: 4rem;
            }

            .badge-title {
                font-size: 1.8rem;
            }

            .concept-grid {
                grid-template-columns: 1fr;
            }

            .zopa-visual {
                flex-direction: column;
            }

            .zopa-zone {
                flex: 1;
                width: 100%;
            }

            .value-options {
                grid-template-columns: 1fr;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }

            .score-value {
                font-size: 3rem;
            }

            .flashcards-grid {
                grid-template-columns: 1fr;
            }

            .flashcard {
                height: 400px;
            }

            .flashcard-front h3 {
                font-size: 1.4rem;
            }

            .progress-number {
                font-size: 2rem;
            }

            .term-options {
                grid-template-columns: 1fr;
            }

            .score-bars {
                flex-direction: column;
                gap: 15px;
            }

            .term-header {
                flex-direction: column;
            }

            .term-title {
                margin-left: 0;
                margin-top: 10px;
            }

            .choice-btn {
                padding: 15px;
            }

            .choice-letter {
                font-size: 1.2rem;
            }

            .final-score {
                font-size: 3rem;
            }

            .score-label {
                font-size: 1.5rem;
            }

            .email-actions {
                flex-direction: column;
            }

            .email-btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .badge-content {
                padding: 30px 20px;
                max-width: 90%;
            }

            .badge-icon {
                font-size: 4rem;
            }

            .badge-title {
                font-size: 1.8rem;
            }

            .badge-message {
                font-size: 1rem;
            }

            .badge-reveal-btn {
                font-size: 1.2rem;
                padding: 15px 35px;
            }
        }
    </style>
</head>
<body>
    <div class="lesson-container">
        <!-- Header -->
        <div class="lesson-header">
            <h1 class="lesson-title"> Negotiations & Closing</h1>
            <p class="lesson-subtitle">Win Deals at Premium Pricing - Advanced B2B Sales Techniques</p>
            <div class="lesson-meta">
                <div class="meta-item">
                    <span class="meta-icon"></span>
                    <span>10 Kart Interaktywnych</span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon"></span>
                    <span>~75 minut</span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon"></span>
                    <span>120 XP</span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon"></span>
                    <span>Badge: Deal Closer</span>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <span class="progress-label">Twj Postp</span>
                <span class="progress-xp"><span id="currentXP">0</span> / 120 XP</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
        </div>

        <!-- Card 1: Video -->
        <div class="card active" id="card1">
            <div class="card-header">
                <div class="card-number">1/10</div>
                <h2 class="card-title"> The Art of B2B Negotiation</h2>
                <p>Odkryj dlaczego 80% KAM daje rabat za szybko - i jak nalee do top 10% ktrzy negocjuj warto.</p>
            </div>

            <div class="video-container">
                <div class="video-wrapper">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>

                <div class="video-checkpoint">
                    <div class="checkpoint-checkbox">
                        <input type="checkbox" id="videoWatched" onchange="toggleVideoCheckbox()">
                        <label for="videoWatched"> Obejrzaem cae video</label>
                    </div>

                    <div class="reflection-area">
                        <label for="videoReflection">Co najbardziej Ci zaskoczyo w tej strategii negocjacji?</label>
                        <textarea id="videoReflection" placeholder="Wpisz swoj refleksj (min. 30 znakw)..." oninput="autoSaveReflection()"></textarea>
                    </div>
                </div>
            </div>

            <div class="key-points">
                <h3> 5 Kluczowych Punktw:</h3>
                <ol>
                    <li><strong>Negotiation  Price War</strong> - 80% KAM daje rabat za szybko. Top 10% negocjuje warto, nie cen. Rnica: -15% margin vs. +5% margin na tym samym dealu.</li>
                    <li><strong>ZOPA Framework</strong> - Zone of Possible Agreement: Twoja BATNA (Best Alternative To Negotiated Agreement) vs. Their BATNA. Kto ma lepsz alternatyw, ma power.</li>
                    <li><strong>Multi-Stakeholder Dynamics</strong> - Production Manager (YES) + CFO (MAYBE) + Procurement (NO) = Need coalition building. 1 stakeholder  decision maker.</li>
                    <li><strong>Timing is Everything</strong> - Don't negotiate too early (przed udowodnieniem wartoci) or too late (competitor ju locked in). Sweet spot: po pilotau, przed deadline.</li>
                    <li><strong>Win-Win  50/50</strong> - Win-Win = Both sides better off than BATNA, not equal split. Ty: 120k (target 100k), Client: 120k (budget 150k) = both win!</li>
                </ol>
            </div>

            <div class="insight-box">
                <strong> Insight:</strong> Najlepsi negocjatorzy suchaj 70% czasu, mwi 30%. Procurement mwi 80%, sucha 20%. Use this asymmetry to your advantage - zadawaj pytania, odkrywaj ich BATNA, znajd ZOPA.
            </div>

            <div class="success-message" id="videoSuccess"> Video ukoczone! +5 XP</div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()" disabled> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 2: ZOPA Framework -->
        <div class="card" id="card2">
            <div class="card-header">
                <div class="card-number">2/10</div>
                <h2 class="card-title"> ZOPA Framework - Know Your Boundaries</h2>
                <p>Zone of Possible Agreement - fundament kadej negocjacji. Bez tego grasz w ciemno.</p>
            </div>

            <div class="zopa-diagram">
                <h3 style="color: #1565C0; margin-bottom: 25px;">Zone of Possible Agreement (ZOPA)</h3>
                
                <div class="zopa-visual">
                    <div class="zopa-side">
                        <h4>YOUR SIDE (Milwaukee KAM)</h4>
                        <p><strong>Walk-away price:</strong> 80k PLN</p>
                        <p><strong>Target price:</strong> 100k PLN</p>
                        <p><strong>Your BATNA:</strong> Sell to competitor client</p>
                    </div>

                    <div class="zopa-zone">
                         ZOPA <br>
                        <small style="font-size: 0.7rem;">80k - 120k</small>
                    </div>

                    <div class="zopa-side">
                        <h4>THEIR SIDE (Client)</h4>
                        <p><strong>Max budget:</strong> 120k PLN</p>
                        <p><strong>Best case:</strong> 85k PLN</p>
                        <p><strong>Their BATNA:</strong> Buy from Bosch at 70k</p>
                    </div>
                </div>

                <p style="margin-top: 20px; color: #1565C0; font-weight: 600;">
                    ZOPA istnieje bo: Your min (80k) < Their max (120k). Deal moliwy w przedziale 80-120k PLN.
                </p>
            </div>

            <div class="concept-grid">
                <div class="concept-card">
                    <h4>1 BATNA</h4>
                    <p><strong>Best Alternative To Negotiated Agreement</strong></p>
                    <p><strong>Your BATNA:</strong> Co zrobisz jeli deal upadnie? (Sprzeda innemu klientowi, walk away, pivot to smaller deal)</p>
                    <p><strong>Their BATNA:</strong> Co oni zrobi? (Kupi od Boscha, opni zakup, pjd z konkurencj)</p>
                    <div class="rule"> Power Rule: Whoever has better BATNA has more negotiation power</div>
                </div>

                <div class="concept-card">
                    <h4>2 Reservation Price</h4>
                    <p><strong>Your walk-away price:</strong> Poniej tego = unprofitable deal (80k PLN min margin)</p>
                    <p><strong>Their max budget:</strong> Powyej tego = can't afford (120k CFO approval limit)</p>
                    <p>ZOPA exists when: <strong>Your min < Their max</strong></p>
                    <div class="rule"> If Your min > Their max: No ZOPA = No deal possible (walk away or change scope)</div>
                </div>

                <div class="concept-card">
                    <h4>3 Target vs. Anchor</h4>
                    <p><strong>Target:</strong> Your ideal outcome (100k PLN = twj cel)</p>
                    <p><strong>Anchor:</strong> First number mentioned (sets the negotiation range)</p>
                    <p><strong>Example:</strong> You anchor at 110k  client thinks 100k = discount. You anchor at 95k  client expects 80k.</p>
                    <div class="rule"> Golden Rule: Always anchor HIGH (but justifiable with ROI data)</div>
                </div>

                <div class="concept-card">
                    <h4>4 Value Creation vs. Claiming</h4>
                    <p><strong>Value Creation:</strong> Expand the pie (add services, training, warranty, payment terms = bigger total value)</p>
                    <p><strong>Value Claiming:</strong> Split the pie (discount, haggling = zero-sum game)</p>
                    <p><strong>Top KAM strategy:</strong> Create first (build 150k value package), claim second (settle at 120k = both win)</p>
                    <div class="rule"> Create value BEFORE claiming it. Discount without value creation = lost margin forever.</div>
                </div>
            </div>

            <div class="comparison-table">
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th class="weak"> Weak Negotiator</th>
                            <th class="strong"> Strong Negotiator</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: 600;">Client says "Too expensive"</td>
                            <td class="weak">Gives 15% discount immediately</td>
                            <td class="strong">Asks: "Compared to what? Let's review ROI calculation"</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600;">CFO asks for 20% off</td>
                            <td class="weak">Offers 10% compromise</td>
                            <td class="strong">Offers: 5% discount + 6-month leasing + free training (same margin, higher perceived value)</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600;">Procurement threatens Bosch</td>
                            <td class="weak">Lowers price to match</td>
                            <td class="strong">Says: "Bosch 70k = 43k TCO/3yr. Milwaukee 100k = 23k TCO. You'd lose 20k to save 30k upfront. Shall we pilot both?"</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600;">Deadline pressure</td>
                            <td class="weak">Panics, gives concessions</td>
                            <td class="strong">Uses deadline: "I can lock this price until Friday, then Q2 pricing +8% kicks in"</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="insight-box">
                <strong> Key Takeaway:</strong> ZOPA to mapa negocjacji. Przed kad rozmow pytaj siebie:
                <ul style="margin-top: 10px; margin-left: 20px;">
                    <li>Jaka jest moja BATNA? (Co zrobi jeli deal upadnie?)</li>
                    <li>Jaka jest ich BATNA? (Bosch? Delay? Inny vendor?)</li>
                    <li>Gdzie jest ZOPA? (80-120k? 90-110k? Czy w ogle istnieje?)</li>
                    <li>Jak stworzy warto przed claiming? (Package, not discount)</li>
                </ul>
            </div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 3: Negotiation Simulator -->
        <div class="card" id="card3">
            <div class="card-header">
                <div class="card-number">3/10</div>
                <h2 class="card-title"> Negotiation Simulator - Test Your Skills</h2>
                <p>8 scenariuszy z rzeczywistych negocjacji B2B. Wybierz najlepsz odpowied i zobacz instant feedback.</p>
            </div>

            <div class="scenario-container" id="scenarioContainer">
                <!-- Scenarios rendered by JavaScript -->
            </div>

            <div class="score-display" id="scenarioScore">
                <h3>Twj Wynik</h3>
                <div class="score-value" id="scoreValue">0/8</div>
                <div class="score-interpretation" id="scoreInterpretation"></div>
            </div>

            <div class="success-message" id="scenarioSuccess"> Simulator ukoczony! +20 XP</div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 4: Value Stacking -->
        <div class="card" id="card4">
            <div class="card-header">
                <div class="card-number">4/10</div>
                <h2 class="card-title"> Value Stacking - Build the Package</h2>
                <p>Client chce -15% rabatu (18k PLN). Zamiast discount, zbuduj value-add package ktry kosztuje Ciebie mniej, a jest wart wicej dla klienta.</p>
            </div>

            <div class="scenario-intro">
                <h3> Sytuacja:</h3>
                <p>Deal: 120,000 PLN za kompletny zestaw narzdzi Milwaukee dla automotive Tier 1 supplier.</p>
                <p class="problem"> Client: "Bosch offers same for 102k. Match it or we're out."</p>
                <p style="margin-top: 15px;"><strong>Your strategy:</strong> Nie obniaj ceny. Dodaj warto ktra kosztuje Ciebie 5-7k PLN, ale klient odbiera jako 25-35k PLN value. Target: Value/Cost ratio >3</p>
            </div>

            <div class="value-builder">
                <h3 style="margin-bottom: 20px;">Wybierz Value-Add Options:</h3>
                
                <div class="value-options">
                    <div class="value-option" id="valueOption0">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value0" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">Extended Warranty (5 lat zamiast 3)</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">2,000 PLN</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">8,000 PLN</span>
                                    </div>
                                </div>
                                <div class="value-description">CFO uwielbia: eliminuje risk, obnia budget uncertainty o 8k/5yr</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption1">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value1" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">On-site Training (2 dni, 20 pracownikw)</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">3,000 PLN</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">12,000 PLN</span>
                                    </div>
                                </div>
                                <div class="value-description">PM uwielbia: reduces downtime 1st month (10h saved = 8k PLN), faster adoption</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption2">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value2" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">ONE-KEY Setup + Integration</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">1,500 PLN</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">8,000 PLN</span>
                                    </div>
                                </div>
                                <div class="value-description">Procurement uwielbia: tool tracking eliminuje 30% loss rate (12k savings/3yr)</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption3">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value3" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">Spare Battery Pack (10 baterii 5.0Ah)</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">2,500 PLN</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">6,000 PLN</span>
                                    </div>
                                </div>
                                <div class="value-description">PM uwielbia: zero downtime risk, no charging delays</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption4">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value4" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">Priority Support (SLA 4h response)</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">1,000 PLN/rok</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">5,000 PLN/rok</span>
                                    </div>
                                </div>
                                <div class="value-description">CFO uwielbia: predictable support cost, PM uwielbia: fast resolution</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption5">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value5" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">Flexible Payment Terms (Net 60 zamiast 30)</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">800 PLN</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">4,000 PLN</span>
                                    </div>
                                </div>
                                <div class="value-description">CFO uwielbia: cash flow improvement, 30-day float = 4k working capital</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption6">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value6" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">Quarterly Business Reviews (QBR + optimization)</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">1,200 PLN/rok</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">6,000 PLN/rok</span>
                                    </div>
                                </div>
                                <div class="value-description">PM + Procurement: partnership feeling, continuous improvement, usage optimization</div>
                            </div>
                        </div>
                    </div>

                    <div class="value-option" id="valueOption7">
                        <div class="value-checkbox">
                            <input type="checkbox" id="value7" onchange="calculateValueStack()">
                            <div>
                                <div class="value-name">Case Study Rights + Co-Marketing</div>
                                <div class="value-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Cost to you:</span>
                                        <span class="metric-value">500 PLN</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Perceived value:</span>
                                        <span class="metric-value green">3,000 PLN</span>
                                    </div>
                                </div>
                                <div class="value-description">CEO uwielbia: brand visibility, recruitment tool ("We work with Milwaukee")</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="calculator-results">
                    <h3 style="color: #2E7D32; margin-bottom: 20px;"> Your Value Package:</h3>
                    
                    <div class="result-grid">
                        <div class="result-box">
                            <div class="result-label">Total Cost to You</div>
                            <div class="result-value" id="totalCost">0 PLN</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Perceived Value</div>
                            <div class="result-value" id="perceivedValue">0 PLN</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Value/Cost Ratio</div>
                            <div class="result-value ratio" id="valueRatio">0</div>
                        </div>
                    </div>

                    <div class="generated-statement" id="generatedStatement" style="display: none;">
                        <h4> Your Offer Statement:</h4>
                        <p id="statementText"></p>
                    </div>
                </div>

                <button class="save-button" id="saveValueBtn" onclick="saveValueStack()" disabled>Zapisz Package (+15 XP)</button>
                <div class="success-message" id="valueSuccess"> Value Package zapisany! +15 XP</div>
            </div>

            <div class="insight-box">
                <strong> Key Insight:</strong> Value stacking to gra psychologiczna. Client widzi 5 value-adds = 35k PLN perceived value. Ty pacisz 6k PLN real cost. Client myli: "120k base + 35k extras = 155k total value, paying 120k = 23% discount!". Reality: Ty nadal masz margin 120k - 6k = 114k. Procurement happy, CFO happy, PM happy, Ty happy. 
            </div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 5: Closing Techniques -->
        <div class="card" id="card5">
            <div class="card-header">
                <div class="card-number">5/10</div>
                <h2 class="card-title"> Closing Techniques - 5 Proven Methods</h2>
                <p>Najlepsze techniki zamykania sprzeday B2B. Click karty aby zobaczy szczegy.</p>
            </div>

            <div class="flashcards-container">
                <div class="flashcards-grid">
                    <!-- Flashcard 1: Assumptive Close -->
                    <div class="flashcard" id="flashcard0" onclick="flipClosingCard(0)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">1/5</div>
                                <h3> Assumptive Close</h3>
                                <p>Zakadasz e klient ju zdecydowa. Przechodzisz do detali implementacji.</p>
                                <div class="flip-hint"> Kliknij aby zobaczy jak uywa</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> Kiedy uywa:</h4>
                                <p>Client pozytywnie reaguje na propozycj, zadaje pytania o szczegy (nie o cen), mwi "to brzmi dobrze" lub "ciekawe". Pilot zakoczony sukcesem.</p>

                                <h4> Technika:</h4>
                                <p>Zamiast pyta "Czy chcesz kupi?", pytasz o szczegy IMPLEMENTACJI: "Kiedy chcesz delivery?", "Ktry magazyn?", "Kto bdzie contact person?"</p>

                                <div class="script">
                                    <strong>Script:</strong><br>
                                    "Super! Kiedy najlepiej zaplanowa delivery - najbliszy wtorek czy czwartek? I do ktrego magazynu - Pozna czy Wrocaw?"
                                </div>

                                <h4> Dlaczego dziaa:</h4>
                                <p>Client odpowiada na pytania = psychologicznie commited. Nie ma "czy", tylko "kiedy" i "jak". Natural flow od rozmowy do transakcji.</p>

                                <div class="warning">
                                    <strong> Kiedy NIE uywa:</strong><br>
                                    Client ma wtpliwoci ("musz pomyle"), nie znasz decision criteria, pilot si nie odby. Bdzie wygldao pushy.
                                </div>

                                <div class="example">
                                    <strong> Example - VW case:</strong><br>
                                    After 4-week pilot (zero downtime), KAM: "wietnie! Ktr lini produkcyjn wyposaymy jako pierwsz - Assembly czy Quality Control? I dostaw planujemy na Q1 czy Q2?"  VW PM: "Assembly, Q1 luty." = CLOSED at 180k PLN (no discount discussion).
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Flashcard 2: Alternative Choice -->
                    <div class="flashcard" id="flashcard1" onclick="flipClosingCard(1)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">2/5</div>
                                <h3> Alternative Choice</h3>
                                <p>Dajesz 2 opcje (A lub B), obie prowadz do zamknicia. Client czuje kontrol.</p>
                                <div class="flip-hint"> Kliknij aby zobaczy jak uywa</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> Kiedy uywa:</h4>
                                <p>Client ready do decyzji ale needs ostatni push. CFO lubi mie wybr (control freak). Negocjujesz finalne warunki.</p>

                                <h4> Technika:</h4>
                                <p>Offer 2 variants: Option A (wysza cena, wicej value), Option B (nisza cena, basic). Obie = ty wygrywasz. Client wybiera swoj wersj wygranej.</p>

                                <div class="script">
                                    <strong>Script - Pricing variant:</strong><br>
                                    "Mamy 2 opcje: <strong>Option A</strong> - 120k PLN, delivery grudzie, peny pakiet z training + warranty. <strong>Option B</strong> - 110k PLN, delivery luty, basic package. Ktra bardziej pasuje do Waszego budetu?"<br><br>
                                    <strong>Script - Scope variant:</strong><br>
                                    "Moemy zacz: <strong>A)</strong> Pena linia (180k), wszystko od razu, ROI od Q1. <strong>B)</strong> Pilot 2 stanowiska (40k), test 6 tygodni, potem scale. Co preferujecie?"
                                </div>

                                <h4> Dlaczego dziaa:</h4>
                                <p>Client nie wybiera "buy vs not buy". Wybiera "which way to buy". Psychology: Having choice = feeling empowered. Ty kontrolujesz obie opcje = win-win.</p>

                                <div class="warning">
                                    <strong> Kiedy NIE uywa:</strong><br>
                                    Tylko 1 real option (fake choice = manipulacja). Client potrzebuje wicej info (discovery phase). Zbyt wiele opcji (3+ = paralysis).
                                </div>

                                <div class="example">
                                    <strong> Example - Mahle automotive:</strong><br>
                                    CFO indecisive between 140k (full line) and 90k (partial). KAM: "Rozumiem concern. 2 opcje: <strong>A)</strong> 140k now, payment Net 90 (cash flow relief). <strong>B)</strong> 90k now, 50k Q2 (split risk). Ktra lepsza dla budetu?"  CFO: "B, split makes sense." = 140k total CLOSED in 2 tranches.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Flashcard 3: Urgency (Ethical) -->
                    <div class="flashcard" id="flashcard2" onclick="flipClosingCard(2)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">3/5</div>
                                <h3> Urgency Close (Ethical)</h3>
                                <p>Real deadline zmusza do decyzji. Nie fake pressure - prawdziwe konsekwencje.</p>
                                <div class="flip-hint"> Kliknij aby zobaczy jak uywa</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> Kiedy uywa:</h4>
                                <p>Client "potrzebuj pomyle" (thinking = stalling). Realnie istnieje deadline (price change, promo end, stock limitation, seasonal window).</p>

                                <h4> Technika:</h4>
                                <p>Communicate REAL consequences of delay. Not fake "offer expires tomorrow" (sleazy). Real: price increase, stock depletion, seasonal impact, competitor moving faster.</p>

                                <div class="script">
                                    <strong>Script - Price increase (real):</strong><br>
                                    "Totally understand you need time. One thing to consider: Q1 pricing ends Friday (Dec 29). Q2 kicks in with +8% adjustment = extra 9,600 PLN on this order. If you can confirm by Thursday, I'll lock current price. Otherwise, we'll revisit in Q2 at 129k instead of 120k."<br><br>
                                    <strong>Script - Stock limitation (real):</strong><br>
                                    "We have 15 units in Poland warehouse now. Our distributor ships 80% to Germany (higher demand). If we don't reserve yours by Friday, they'll go there, and next batch is 6 weeks out. Your production starts when - March?"<br><br>
                                    <strong>Script - Competitive (ethical):</strong><br>
                                    "I know you're evaluating Bosch too. Fair. One heads-up: Their lead time is 12 weeks now (checked yesterday). Ours is 3 weeks. If you need tools before Q2, timing matters. Just info, your call."
                                </div>

                                <h4> Dlaczego dziaa:</h4>
                                <p>Loss aversion > Gain seeking. Client fears losing deal/price/timing more than fears buying. FOMO (Fear Of Missing Out) when grounded in facts.</p>

                                <div class="warning">
                                    <strong> Kiedy NIE uywa:</strong><br>
                                    Fake deadline (client checks, you lose trust). Too early (before value established). Client already sold (why rush?). Aggressive tone (turns people off).
                                </div>

                                <div class="example">
                                    <strong> Example - KGHM mining:</strong><br>
                                    Client stalling 3 weeks ("budget meeting soon"). KAM: "Understood. FYI: Milwaukee HQ announced +6% price adjustment Feb 1 (raw materials costs). Your 85k quote becomes 90k. I can hold 85k until Jan 25 (written confirmation). After that, new pricing applies. Let me know by Wednesday?"  Client signed Friday (saved 5k, felt smart). CLOSED at target price.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Flashcard 4: Summary/Trial Close -->
                    <div class="flashcard" id="flashcard3" onclick="flipClosingCard(3)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">4/5</div>
                                <h3> Summary Close</h3>
                                <p>Podsumuj uzgodnienia, sprawd czy client gotowy. Test waters przed final ask.</p>
                                <div class="flip-hint"> Kliknij aby zobaczy jak uywa</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> Kiedy uywa:</h4>
                                <p>Po dugiej rozmowie (60+ min), multi-stakeholder meeting, wiele ustale. Chcesz test czy client ready do decyzji (trial close) przed final ask.</p>

                                <h4> Technika:</h4>
                                <p>Recap wszystkie agreed points: problem, solution, ROI, concerns addressed, timeline. Potem pytasz: "Czy co pominem?" lub "Czy widzisz jakie blockers?" (soft close). If "no blockers"  move to assumptive close.</p>

                                <div class="script">
                                    <strong>Script - 4 stakeholders:</strong><br>
                                    "Super, podsumujmy ebymy byli on same page:<br><br>
                                    <strong>Problem:</strong> 18h downtime/month, kosztuje Was 14k PLN<br>
                                    <strong>Solution:</strong> Milwaukee M18 line, ONE-KEY tracking<br>
                                    <strong>ROI:</strong> Downtime 4h/month = 10k savings/month, payback 12 months<br>
                                    <strong>PM concern (training):</strong> Addressed - 2-day on-site included<br>
                                    <strong>CFO concern (warranty):</strong> 5-year extended warranty included<br>
                                    <strong>Procurement concern (price):</strong> TCO 23k vs Bosch 43k (20k savings 3yr)<br>
                                    <strong>Timeline:</strong> Delivery March, training April<br><br>
                                    Czy co pominem? Jakie inne questions?"<br><br>
                                    <em>(If they say "no, all good"):</em><br>
                                    "Perfect! W takim razie przygotujemy kontrakt na 120k z tymi warunkami. Kto po Waszej stronie go podpisze - [CFO name]?"
                                </div>

                                <h4> Dlaczego dziaa:</h4>
                                <p>Client hears own "yes" multiple times (agree, agree, agree). Psychologically commits step-by-step. Summary = recap value, remind why they wanted this. Final question reveals objections OR confirms readiness.</p>

                                <div class="warning">
                                    <strong> Kiedy NIE uywa:</strong><br>
                                    Short meeting (10 min summary = overkill). Client already said "yes" (move to assumptive). Major objections unresolved (summary won't help).
                                </div>

                                <div class="example">
                                    <strong> Example - Automotive Tier 1 (4 stakeholders):</strong><br>
                                    After 90-min meeting, KAM summarized: Problem (15h downtime), Solution (M18), ROI (35k/3yr), 4 concerns addressed. Asked: "Anything else?" PM: "No, looks solid." CFO: "Numbers make sense." Procurement: "TCO is convincing."  KAM (assumptive): "Great! I'll send contract tomorrow, delivery March 15. Who signs - [CFO]?" CFO: "Yes, send it." = CLOSED 200k PLN, no discount.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Flashcard 5: Puppy Dog (Pilot) -->
                    <div class="flashcard" id="flashcard4" onclick="flipClosingCard(4)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">5/5</div>
                                <h3> Puppy Dog Close</h3>
                                <p>"Take it home, try it, fall in love." Pilot eliminuje risk, proves value.</p>
                                <div class="flip-hint"> Kliknij aby zobaczy jak uywa</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> Kiedy uywa:</h4>
                                <p>Client skeptical ("Bosch works fine"), high perceived risk ("What if it doesn't work?"), procurement blockers ("We need proof"). You're confident pilot converts (product is strong).</p>

                                <h4> Technika:</h4>
                                <p>Offer time-limited pilot (4-6 weeks) with clear success metrics. Client "tries before buys", risk-free. After pilot, assumptive close (they're already using it, switching back = pain).</p>

                                <div class="script">
                                    <strong>Script - Risk elimination:</strong><br>
                                    "I get it - switching vendors feels risky. Here's what we'll do: <strong>4-week pilot</strong>.<br><br>
                                    We'll deploy Milwaukee on Line 3 (your high-downtime area). Track:<br>
                                     Downtime hours (target: <10h/month vs current 18h)<br>
                                     Battery life (charge cycles)<br>
                                     Worker feedback (ease of use)<br><br>
                                    If downtime DOESN'T drop below 12h = we pull tools back, no charge, no questions.<br>
                                    If downtime DOES drop = we discuss full line rollout at 120k.<br><br>
                                    Fair? You risk nothing, we risk everything. Deal?"<br><br>
                                    <strong>Script - After pilot (assumptive):</strong><br>
                                    "Pilot results: Downtime 6h (vs target 10h). Workers love ONE-KEY. Ready to roll out Lines 1-5? Delivery next Tuesday or Thursday?"
                                </div>

                                <h4> Dlaczego dziaa:</h4>
                                <p>Endowment effect: Once they USE it, it feels like THEIRS. Removing it = loss (painful). Pilot proves value = eliminates objections. 80-85% pilot conversion rate for quality products.</p>

                                <div class="warning">
                                    <strong> Kiedy NIE uywa:</strong><br>
                                    Pilot costs you too much (freight, setup, support). Client won't commit to success metrics (pilot = free tools forever). Product not proven (pilot might backfire). Client already decided (why delay?).
                                </div>

                                <div class="example">
                                    <strong> Example - VW Pozna:</strong><br>
                                    Procurement loyal to Bosch (8 years). KAM offered: 4-week pilot, 2 assembly lines, downtime target <8h. VW agreed ("no risk"). Results: 4h downtime (vs Bosch 14h). Workers preferred Milwaukee (lighter, faster). After pilot, VW PM: "When can we get 50 more units?" = 180k PLN order, no discount, no RFP. Pilot eliminated all objections.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flashcard-progress">
                    <h3>Progress: Przejrzane Karty</h3>
                    <div class="progress-number" id="closingProgress">0/5</div>
                    <div class="flashcard-buttons">
                        <button class="flashcard-btn primary" onclick="markAllClosingKnown()"> Znam wszystkie</button>
                        <button class="flashcard-btn" onclick="resetClosingCards()"> Resetuj</button>
                    </div>
                </div>

                <div class="success-message" id="closingSuccess"> Wszystkie techniki przejrzane! +15 XP</div>
            </div>

            <div class="insight-box">
                <strong> Masterclass Tip:</strong> Top 10% KAM uywa MIX technik w 1 rozmowie:<br>
                1. <strong>Summary Close</strong> (podsumuj uzgodnienia)<br>
                2. <strong>Alternative Choice</strong> ("120k full lub 90k basic?")<br>
                3. <strong>Assumptive</strong> ("Super, delivery wtorek czy czwartek?")<br>
                4. If resistance  <strong>Urgency</strong> ("Price holds until Friday")<br>
                5. If high risk  <strong>Puppy Dog</strong> ("Let's pilot 4 weeks")<br><br>
                Read the room. Client confident? Assumptive. Client nervous? Puppy Dog. Client indecisive? Alternative Choice. Adapt = close rate 60-80% vs 30-40% average.
            </div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 6: Contract Negotiation -->
        <div class="card" id="card6">
            <div class="card-header">
                <div class="card-number">6/10</div>
                <h2 class="card-title"> Contract Negotiation - 10 Key Terms</h2>
                <p>Kady kontrakt B2B ma 10 kluczowych warunkw. Nie wszystkie musz by po Twojej stronie - ale musisz wiedzie ktre s critical.</p>
            </div>

            <div class="contract-intro">
                <h3> Cel: Balanced Contract</h3>
                <p>Nie wygrywaj wszystkich punktw (client si wywrci). Nie przegrywaj wszystkich (Ty stracisz).</p>
                <p style="margin-top: 10px;"><strong>Target:</strong> 40-60% client-favorable terms. Ty ustpujesz w low-cost areas (payment terms, reporting), trzymasz firm w high-value (price, warranty, IP). Client czuje win, Ty chronisz margin.</p>
            </div>

            <div class="contract-checklist">
                <!-- Term 1: Payment Terms -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">1/10</div>
                        <div class="term-title">
                            <h4> Payment Terms</h4>
                            <p class="term-description">Kiedy client paci: Net 30 (standard), Net 60 (client win), Net 90 (duy ustp)</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="payment_vendor" name="payment" value="vendor">
                            <label for="payment_vendor">
                                <span class="option-label">Net 30</span>
                                <span class="option-description">Vendor-favorable</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="payment_neutral" name="payment" value="neutral" checked>
                            <label for="payment_neutral">
                                <span class="option-label">Net 45</span>
                                <span class="option-description">Neutral</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="payment_client" name="payment" value="client">
                            <label for="payment_client">
                                <span class="option-label">Net 60-90</span>
                                <span class="option-description">Client-favorable</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>Give Net 60 only if: 1) Large deal (>150k), 2) Client has strong financials (no payment risk), 3) You get something back (volume commit, exclusive). CFO loves Net 60 (cash flow). Costs you ~800 PLN per 100k (finance cost).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes1">Your Notes:</label>
                        <textarea id="notes1" placeholder="Np. Net 60 OK if they commit to 200k annual volume" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 2: Volume Commitment -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">2/10</div>
                        <div class="term-title">
                            <h4> Volume Commitment</h4>
                            <p class="term-description">Czy client gwarantuje minimum purchase volume rocznie?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="volume_vendor" name="volume" value="vendor">
                            <label for="volume_vendor">
                                <span class="option-label">Hard commit</span>
                                <span class="option-description">200k PLN/rok minimum</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="volume_neutral" name="volume" value="neutral" checked>
                            <label for="volume_neutral">
                                <span class="option-label">Soft target</span>
                                <span class="option-description">"Best effort" 150k</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="volume_client" name="volume" value="client">
                            <label for="volume_client">
                                <span class="option-label">No commit</span>
                                <span class="option-description">Order as needed</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>Hard commit = you can forecast, plan inventory, offer better price. Trade: "I'll give Net 60 + 3% discount IF you commit 200k annual minimum". Soft target = no penalty if they don't hit. No commit = they can ghost anytime (risky for you).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes2">Your Notes:</label>
                        <textarea id="notes2" placeholder="Np. Soft target 150k acceptable, no hard commit needed" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 3: Price Protection -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">3/10</div>
                        <div class="term-title">
                            <h4> Price Protection</h4>
                            <p class="term-description">Czy cena moe wzrosn w trakcie kontraktu (12 miesicy)?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="price_vendor" name="price" value="vendor">
                            <label for="price_vendor">
                                <span class="option-label">Flexible</span>
                                <span class="option-description">Price adjusts quarterly</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="price_neutral" name="price" value="neutral" checked>
                            <label for="price_neutral">
                                <span class="option-label">Capped</span>
                                <span class="option-description">Max +5% annually</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="price_client" name="price" value="client">
                            <label for="price_client">
                                <span class="option-label">Locked</span>
                                <span class="option-description">Fixed 12-24 months</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>CFO wants locked (budget certainty). You want flexible (protect from material cost spikes). Compromise: Lock 12 months, then renegotiate. OR: Lock price IF volume >200k, flexible if <200k. Never lock 24+ months (inflation risk).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes3">Your Notes:</label>
                        <textarea id="notes3" placeholder="Np. 12-month lock OK, review annually" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 4: Exclusivity -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">4/10</div>
                        <div class="term-title">
                            <h4> Exclusivity</h4>
                            <p class="term-description">Czy client moe kupowa od innych vendorw (Bosch, DeWalt)?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="exclusive_vendor" name="exclusive" value="vendor">
                            <label for="exclusive_vendor">
                                <span class="option-label">Exclusive</span>
                                <span class="option-description">Only Milwaukee</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="exclusive_neutral" name="exclusive" value="neutral" checked>
                            <label for="exclusive_neutral">
                                <span class="option-label">Preferred</span>
                                <span class="option-description">Milwaukee 1st choice</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="exclusive_client" name="exclusive" value="client">
                            <label for="exclusive_client">
                                <span class="option-label">Multi-vendor</span>
                                <span class="option-description">Client's choice</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>Exclusive = you own account (high value), client loses negotiation leverage (risky for them). Trade: "Exclusive IF I give 7% volume discount + priority delivery". Preferred = you're default but not only. Multi-vendor = you compete every order (exhausting).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes4">Your Notes:</label>
                        <textarea id="notes4" placeholder="Np. Preferred vendor status acceptable" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 5: Delivery & Lead Time -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">5/10</div>
                        <div class="term-title">
                            <h4> Delivery Terms & SLA</h4>
                            <p class="term-description">Jak szybko dostarczasz? Co jeli si spnisz?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="delivery_vendor" name="delivery" value="vendor">
                            <label for="delivery_vendor">
                                <span class="option-label">Best effort</span>
                                <span class="option-description">4-6 weeks, no penalty</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="delivery_neutral" name="delivery" value="neutral" checked>
                            <label for="delivery_neutral">
                                <span class="option-label">Target SLA</span>
                                <span class="option-description">3 weeks, minor penalty</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="delivery_client" name="delivery" value="client">
                            <label for="delivery_client">
                                <span class="option-label">Strict SLA</span>
                                <span class="option-description">2 weeks or 5% credit</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>PM wants fast (production deadlines). You need buffer (supply chain risk). Compromise: 3-week target, 2% credit if >4 weeks (protects you from 1-week delays). Never commit <2 weeks unless stock ready. Penalty cap: 5% max (protect downside).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes5">Your Notes:</label>
                        <textarea id="notes5" placeholder="Np. 3-week target with 2% penalty if >4 weeks" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 6: Warranty & SLA -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">6/10</div>
                        <div class="term-title">
                            <h4> Warranty & Support SLA</h4>
                            <p class="term-description">Jak duga gwarancja? Jak szybki response na issues?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="warranty_vendor" name="warranty" value="vendor">
                            <label for="warranty_vendor">
                                <span class="option-label">Standard</span>
                                <span class="option-description">3yr warranty, 48h response</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="warranty_neutral" name="warranty" value="neutral" checked>
                            <label for="warranty_neutral">
                                <span class="option-label">Enhanced</span>
                                <span class="option-description">4yr warranty, 24h response</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="warranty_client" name="warranty" value="client">
                            <label for="warranty_client">
                                <span class="option-label">Premium</span>
                                <span class="option-description">5yr warranty, 4h response</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>5yr warranty costs you 2k PLN (low), perceived value 8k (high) = great trade. 4h response SLA = operational burden (need 24/7 coverage). Compromise: 5yr warranty + 24h response (client happy, you manageable). Premium SLA only for >200k deals.</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes6">Your Notes:</label>
                        <textarea id="notes6" placeholder="Np. 5yr warranty OK, 24h response acceptable" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 7: Termination Clause -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">7/10</div>
                        <div class="term-title">
                            <h4> Termination Clause</h4>
                            <p class="term-description">Jak atwo client moe zerwa kontrakt?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="termination_vendor" name="termination" value="vendor">
                            <label for="termination_vendor">
                                <span class="option-label">Locked</span>
                                <span class="option-description">12-month minimum, penalty</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="termination_neutral" name="termination" value="neutral" checked>
                            <label for="termination_neutral">
                                <span class="option-label">Notice</span>
                                <span class="option-description">90-day notice required</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="termination_client" name="termination" value="client">
                            <label for="termination_client">
                                <span class="option-label">Flexible</span>
                                <span class="option-description">30-day notice, no penalty</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>Client wants flexibility (what if you suck?). You want lock-in (ROI on sales effort). Compromise: 90-day notice (gives you time to find replacement revenue). Penalty only if <6 months (protects you from instant churn). For cause termination = always allowed (quality issues).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes7">Your Notes:</label>
                        <textarea id="notes7" placeholder="Np. 90-day notice OK, no penalty needed" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 8: Performance Guarantees -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">8/10</div>
                        <div class="term-title">
                            <h4> Performance Guarantees</h4>
                            <p class="term-description">Czy gwarantujesz konkretne rezultaty (ROI, uptime)?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="performance_vendor" name="performance" value="vendor">
                            <label for="performance_vendor">
                                <span class="option-label">None</span>
                                <span class="option-description">Product sold as-is</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="performance_neutral" name="performance" value="neutral" checked>
                            <label for="performance_neutral">
                                <span class="option-label">Conservative</span>
                                <span class="option-description">30k savings guarantee</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="performance_client" name="performance" value="client">
                            <label for="performance_client">
                                <span class="option-label">Aggressive</span>
                                <span class="option-description">50k or refund 20%</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>CFO loves guarantees (risk transfer). Guarantee only what you CONTROL (product quality, not client usage). Conservative = 70% of expected ROI (buffer for variability). Aggressive = risky unless pilot proves it. Refund cap: 20% max (limits downside).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes8">Your Notes:</label>
                        <textarea id="notes8" placeholder="Np. 30k conservative guarantee after pilot proof" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 9: IP & Data Rights -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">9/10</div>
                        <div class="term-title">
                            <h4> IP & Data Rights</h4>
                            <p class="term-description">Kto owns usage data (ONE-KEY tracking)? Czy moesz uy jako case study?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="ip_vendor" name="ip" value="vendor">
                            <label for="ip_vendor">
                                <span class="option-label">You own</span>
                                <span class="option-description">Full data & case study rights</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="ip_neutral" name="ip" value="neutral" checked>
                            <label for="ip_neutral">
                                <span class="option-label">Shared</span>
                                <span class="option-description">Anonymized data OK</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="ip_client" name="ip" value="client">
                            <label for="ip_client">
                                <span class="option-label">Client owns</span>
                                <span class="option-description">No data sharing, NDA</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>Client paranoid about data (IP theft fears). You want case studies (sales ammo). Compromise: Anonymized aggregate data (no client names), case study with approval. Trade: Give full NDA IF they let you use "Automotive Tier 1 Poland" (no logo). Worth 3k marketing value.</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes9">Your Notes:</label>
                        <textarea id="notes9" placeholder="Np. Anonymized case study acceptable with approval" oninput="saveContractData()"></textarea>
                    </div>
                </div>

                <!-- Term 10: Auto-Renewal -->
                <div class="contract-term">
                    <div class="term-header">
                        <div class="term-number">10/10</div>
                        <div class="term-title">
                            <h4> Auto-Renewal</h4>
                            <p class="term-description">Czy kontrakt odnawia si automatycznie po 12 miesicach?</p>
                        </div>
                    </div>

                    <div class="term-options">
                        <div class="term-option">
                            <input type="radio" id="renewal_vendor" name="renewal" value="vendor">
                            <label for="renewal_vendor">
                                <span class="option-label">Auto-renew</span>
                                <span class="option-description">Unless 60-day notice</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="renewal_neutral" name="renewal" value="neutral" checked>
                            <label for="renewal_neutral">
                                <span class="option-label">Review</span>
                                <span class="option-description">Renegotiate at 12mo</span>
                            </label>
                        </div>
                        <div class="term-option">
                            <input type="radio" id="renewal_client" name="renewal" value="client">
                            <label for="renewal_client">
                                <span class="option-label">Fixed term</span>
                                <span class="option-description">12mo, then ends</span>
                            </label>
                        </div>
                    </div>

                    <div class="leverage-box">
                        <h5> Leverage:</h5>
                        <p>You want auto-renew (revenue continuity, no re-sale effort). Client wants flexibility (market changes). Compromise: Auto-renew with 90-day opt-out notice + annual pricing review. Protects both sides. Avoid fixed term (have to re-sell every year = exhausting).</p>
                    </div>

                    <div class="term-notes">
                        <label for="notes10">Your Notes:</label>
                        <textarea id="notes10" placeholder="Np. Auto-renew with 90-day opt-out acceptable" oninput="saveContractData()"></textarea>
                    </div>
                </div>
            </div>

            <div class="balance-score">
                <h3> Contract Balance Score</h3>
                <div class="score-bars">
                    <div class="score-bar client">
                        <h4>Client-Favorable</h4>
                        <div class="value" id="clientScore">0</div>
                    </div>
                    <div class="score-bar neutral">
                        <h4>Neutral</h4>
                        <div class="value" id="neutralScore">0</div>
                    </div>
                    <div class="score-bar vendor">
                        <h4>Vendor-Favorable</h4>
                        <div class="value" id="vendorScore">0</div>
                    </div>
                </div>

                <div class="balance-interpretation">
                    <p id="balanceText">Wybierz opcje dla wszystkich 10 terminw aby zobaczy balance score.</p>
                    <div class="target">
                         Target: 4-6 client-favorable, 2-4 neutral, 1-3 vendor-favorable = Balanced win-win
                    </div>
                </div>
            </div>

            <button class="save-button" id="saveContractBtn" onclick="saveContract()">Zapisz Kontrakt (+10 XP)</button>
            <div class="success-message" id="contractSuccess"> Contract saved! +10 XP</div>

            <div class="insight-box">
                <strong> Pro Tip:</strong> Najlepsze kontrakty = client wygrywa w visible areas (payment terms, termination flexibility, data privacy) = happy Procurement. Ty wygrywasz w invisible areas (price locked, warranty cost-effective, performance guarantees conservative) = margin protected. Client myli e wygra negocjacj. Reality: Both won, strategic trade-offs. 
            </div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 7: Objection Handling -->
        <div class="card" id="card7">
            <div class="card-header">
                <div class="card-number">7/10</div>
                <h2 class="card-title"> Objection Handling - 6 Tough Scenarios</h2>
                <p>Najczstsze obiekcje w B2B negotiations. DON'T / SAY / ACTION / PROOF framework.</p>
            </div>

            <div class="flashcards-container">
                <div class="flashcards-grid">
                    <!-- Objection 1: Competitor Price War -->
                    <div class="flashcard" id="objection0" onclick="flipObjectionCard(0)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">1/6</div>
                                <h3> Competitor Price War</h3>
                                <p>"Bosch offers us 30% less. Match it or we're out."</p>
                                <div class="flip-hint"> Kliknij aby zobaczy odpowied</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> DON'T SAY:</h4>
                                <p>"That's impossible, Bosch quality is lower" (defensive, attacks competitor)</p>
                                <p>"OK, we'll match 70k" (instant capitulation, no value defense)</p>
                                <p>"You're lying, show me the quote" (accusatory, burns bridge)</p>

                                <h4> SAY:</h4>
                                <div class="script">
                                    "Interesting - I'd love to see that Bosch proposal to make sure we're comparing apples-to-apples. Often the upfront price looks lower, but the TCO tells a different story. Can we review what's included in their 70k vs our 100k?"<br><br>
                                    <em>Then pivot:</em><br>
                                    "If Bosch truly offers identical spec at 70k, let's calculate 3-year total cost. Our data shows Bosch 70k upfront = 43k TCO (15h downtime/month). Milwaukee 100k = 23k TCO (4h downtime). You'd lose 20k savings to save 30k upfront. Does that math work for you?"
                                </div>

                                <h4> ACTION:</h4>
                                <p>1. <strong>Request proof</strong>: "Can I see the Bosch quote?" (often bluffing or misunderstanding scope)<br>
                                2. <strong>TCO comparison</strong>: Build side-by-side table (upfront vs 3yr cost)<br>
                                3. <strong>Offer pilot</strong>: "Let's test both for 4 weeks. Whichever has lower downtime wins. Fair?"<br>
                                4. <strong>Find allies</strong>: PM/CFO care about TCO, Procurement cares about price. Coalition around PM.</p>

                                <div class="example">
                                    <strong> PROOF - Mahle Automotive:</strong><br>
                                    Procurement: "Bosch 65k, you 95k. Match or walk." KAM asked for quote, found Bosch = basic tools only (no batteries, chargers, cases). Apples-to-apples: Bosch 82k. Then showed TCO: Bosch 82k + 38k downtime = 120k total. Milwaukee 95k + 18k downtime = 113k. CFO approved Milwaukee. Saved 7k TCO.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Objection 2: Fixed Discount Demand -->
                    <div class="flashcard" id="objection1" onclick="flipObjectionCard(1)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">2/6</div>
                                <h3> Fixed Discount Demand</h3>
                                <p>"We need 20% off. Non-negotiable. That's our policy."</p>
                                <div class="flip-hint"> Kliknij aby zobaczy odpowied</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> DON'T SAY:</h4>
                                <p>"Impossible, we don't give 20%" (dead end, no options)</p>
                                <p>"OK, 15% compromise" (still discounting without creating value)</p>
                                <p>"That's not how we work" (dismissive, alienates client)</p>

                                <h4> SAY:</h4>
                                <div class="script">
                                    "I understand 20% is your target. Let me offer 3 ways to get you there - not through price cut, but through value creation:"<br><br>
                                    <strong>Option 1:</strong> Volume commitment - 200k PLN annual minimum = 8% discount + priority delivery<br>
                                    <strong>Option 2:</strong> Value package - 5% price discount + 15k services (training, warranty, support) = 20k total value<br>
                                    <strong>Option 3:</strong> Payment terms - Net 90 instead of Net 30 = 4k working capital float (perceived as 4% discount)<br><br>
                                    "Which path makes most sense for your budget?"
                                </div>

                                <h4> ACTION:</h4>
                                <p>1. <strong>Reframe</strong>: "Let's find 20% VALUE, not 20% discount"<br>
                                2. <strong>Offer alternatives</strong>: Volume/Value/Payment (choice architecture)<br>
                                3. <strong>Show math</strong>: 5% discount + 15k services = 20k total = same as 20% off 100k<br>
                                4. <strong>Test flexibility</strong>: "If we can't do 20%, what's the walk-away number?" (find BATNA)</p>

                                <div class="example">
                                    <strong> PROOF - CFO 150k deal:</strong><br>
                                    CFO demanded 20% (30k PLN). KAM offered: 7% discount (10.5k) + Net 90 (4.5k float) + 5yr warranty (8k perceived) + QBR (6k perceived) = 29k total value. CFO: "That works, same outcome." Milwaukee kept 143k revenue (vs 120k if gave 20%), client felt 29k win. Both happy.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Objection 3: Internal Pressure -->
                    <div class="flashcard" id="objection2" onclick="flipObjectionCard(2)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">3/6</div>
                                <h3> Internal Pressure</h3>
                                <p>"My CEO is pushing for lower price. I need help defending this."</p>
                                <div class="flip-hint"> Kliknij aby zobaczy odpowied</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> DON'T SAY:</h4>
                                <p>"Just tell CEO it's the best price" (leaves PM alone to fight)</p>
                                <p>"We'll give 10% to make CEO happy" (gives discount without getting intel)</p>
                                <p>"CEO doesn't understand our value" (insults decision-maker)</p>

                                <h4> SAY:</h4>
                                <div class="script">
                                    "I totally get it - CEO pressure is real. Let me help you build the business case. What's CEO's main concern: upfront cost, ROI timeline, or risk?"<br><br>
                                    <em>(Listen, then tailor response:)</em><br><br>
                                    <strong>If cost:</strong> "Let's show 3-year TCO savings of 25k. CEO sees Milwaukee = investment, not expense."<br>
                                    <strong>If ROI:</strong> "Pilot shows 12-month payback. I'll create exec summary: 100k investment  35k Year 1 savings."<br>
                                    <strong>If risk:</strong> "We'll do performance guarantee: <30k savings Year 1 = 10% refund. Zero risk for CEO."
                                </div>

                                <h4> ACTION:</h4>
                                <p>1. <strong>Become PM's consultant</strong>: "What does CEO need to see to approve?"<br>
                                2. <strong>Create exec materials</strong>: 1-page summary with ROI, risk mitigation, case study<br>
                                3. <strong>Offer CEO meeting</strong>: "I'll present TCO directly to CEO if helpful"<br>
                                4. <strong>Give small concession</strong>: 3% discount as "CEO approval gesture" (low cost, high visibility)</p>

                                <div class="example">
                                    <strong> PROOF - Automotive Tier 1:</strong><br>
                                    PM ally, CEO skeptical ("too expensive"). KAM created 2-page exec brief: Problem (18h downtime = 140k loss/yr), Solution (Milwaukee = 4h downtime), ROI (100k investment, 110k savings 3yr, 11-month payback). PM presented, CEO approved. KAM gave 2% "CEO discount" (2k cost, PM looked like hero). Win-win-win.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Objection 4: Firm Pricing Frustration -->
                    <div class="flashcard" id="objection3" onclick="flipObjectionCard(3)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">4/6</div>
                                <h3> Firm Pricing Frustration</h3>
                                <p>"Your price is FIRM? Zero flexibility? This is insulting. Bosch negotiates!"</p>
                                <div class="flip-hint"> Kliknij aby zobaczy odpowied</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> DON'T SAY:</h4>
                                <p>"Take it or leave it" (arrogant, kills relationship)</p>
                                <p>"Fine, 5% off if you sign today" (caving = weak, client will push more)</p>
                                <p>"We're premium, we don't discount" (sounds elitist)</p>

                                <h4> SAY:</h4>
                                <div class="script">
                                    "I hear your frustration - let me clarify. Our PRICE is firm because it's based on proven ROI data (23k TCO vs Bosch 43k). But we have flexibility on TERMS, not price. Here's what I can adjust:"<br><br>
                                     <strong>Payment:</strong> Net 30  Net 60 (worth 2k cash flow to you)<br>
                                     <strong>Delivery:</strong> Standard 4-week  Expedited 2-week (worth 5k to you if urgent)<br>
                                     <strong>Support:</strong> 48h SLA  24h priority (worth 3k/yr perceived value)<br>
                                     <strong>Training:</strong> Add 2-day on-site (worth 12k perceived, costs me 3k)<br><br>
                                    "I'm negotiating WITH you on terms that matter. That's partnership, not price war. Fair?"
                                </div>

                                <h4> ACTION:</h4>
                                <p>1. <strong>Acknowledge emotion</strong>: "I understand this feels rigid"<br>
                                2. <strong>Reframe negotiation</strong>: "We're flexible on WHAT matters to YOU (terms), not on PRICE"<br>
                                3. <strong>Offer value-adds</strong>: Training, warranty, payment = low cost, high perceived value<br>
                                4. <strong>Show data</strong>: "Price = locked because ROI is proven. Discounting breaks the model."</p>

                                <div class="example">
                                    <strong> PROOF - VW Pozna:</strong><br>
                                    Procurement angry: "180k no discount? Insulting!" KAM: "Price firm, but I'll give: Net 75 (vs Net 30), 5yr warranty (vs 3yr), dedicated AM, quarterly reviews. Total value: 180k tools + 18k services = 198k package for 180k price. That's 9% value-add." Procurement: "OK, that's fair." CLOSED same day.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Objection 5: Incumbent Loyalty -->
                    <div class="flashcard" id="objection4" onclick="flipObjectionCard(4)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">5/6</div>
                                <h3> Incumbent Loyalty</h3>
                                <p>"We've used Bosch for 8 years. Why risk switching?"</p>
                                <div class="flip-hint"> Kliknij aby zobaczy odpowied</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> DON'T SAY:</h4>
                                <p>"Bosch is outdated, we're better" (attacks incumbent = defensive)</p>
                                <p>"Just try us, you'll love it" (vague, no risk mitigation)</p>
                                <p>"8 years is too long with one vendor" (insults their decision)</p>

                                <h4> SAY:</h4>
                                <div class="script">
                                    "8 years with Bosch = they've earned your trust. I'm not asking you to abandon that relationship. I'm asking: What would it take to ADD Milwaukee as Line 3 pilot - lowest risk test?"<br><br>
                                    "Here's the idea: Keep Bosch on Lines 1-2 (proven). Deploy Milwaukee on Line 3 only (your highest-downtime area). Run both side-by-side for 6 weeks. Track:<br>
                                     Downtime hours<br>
                                     Battery cycles<br>
                                     Worker preference<br><br>
                                    If Milwaukee underperforms = pull it back, no charge, Bosch wins. If Milwaukee outperforms = you have data to expand. You risk nothing, we risk everything. Fair?"
                                </div>

                                <h4> ACTION:</h4>
                                <p>1. <strong>Respect incumbent</strong>: "Bosch served you well - that's why you're loyal"<br>
                                2. <strong>Pilot proposal</strong>: Side-by-side test (1 line, 6 weeks, data-driven)<br>
                                3. <strong>No-risk offer</strong>: "Underperform = free removal. Outperform = you decide."<br>
                                4. <strong>Success metrics</strong>: Define BEFORE pilot (downtime <10h = Milwaukee wins)</p>

                                <div class="example">
                                    <strong> PROOF - KGHM Mining:</strong><br>
                                    8-year Bosch loyalty. KAM proposed: Pilot Shaft 4 (worst downtime 22h/month). 6-week test. Results: Milwaukee 7h downtime, Bosch 19h. Workers: "Milwaukee lighter, faster." PM: "Let's add Shafts 1-3."  420k PLN 3-year contract. Pilot converted 85% probability into 100% win. Bosch stayed on legacy equipment (no bridge burned).
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Objection 6: Delivery Time -->
                    <div class="flashcard" id="objection5" onclick="flipObjectionCard(5)">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-number">6/6</div>
                                <h3> Delivery Time Objection</h3>
                                <p>"You need 4 weeks delivery? Bosch delivers in 2. We need tools NOW."</p>
                                <div class="flip-hint"> Kliknij aby zobaczy odpowied</div>
                            </div>
                            <div class="flashcard-back">
                                <h4> DON'T SAY:</h4>
                                <p>"Quality takes time" (sounds like excuse)</p>
                                <p>"We can rush for +10% fee" (price penalty = bad optics)</p>
                                <p>"Bosch 2 weeks? I doubt it" (accusatory, no solution)</p>

                                <h4> SAY:</h4>
                                <div class="script">
                                    "I understand urgency - production can't wait. Let me check 3 options:"<br><br>
                                    <strong>Option 1 - Interim loan:</strong> "We have 15 demo units in Poland. I'll loan you 5 tools TODAY (free, 2 weeks) while your main order ships. Zero downtime risk."<br><br>
                                    <strong>Option 2 - Expedited:</strong> "I'll call warehouse - if we find stock in Germany hub, I can expedite to 10 days (vs 4 weeks). No extra charge if I can pull it off."<br><br>
                                    <strong>Option 3 - Partial delivery:</strong> "Ship 50% now (critical tools for Line 1), 50% in 3 weeks (Lines 2-3). You start immediately, we spread logistics."<br><br>
                                    "Which solves your urgency best?"
                                </div>

                                <h4> ACTION:</h4>
                                <p>1. <strong>Validate urgency</strong>: "When EXACTLY do you need tools? (date-specific)"<br>
                                2. <strong>Offer interim solution</strong>: Demo loan buys you time, builds trust<br>
                                3. <strong>Check inventory</strong>: Call distribution - sometimes stock exists closer<br>
                                4. <strong>Split delivery</strong>: 50% fast, 50% standard = client starts production</p>

                                <div class="example">
                                    <strong> PROOF - Automotive emergency:</strong><br>
                                    Client: "Production starts Monday (3 days). Bosch ships Friday." KAM: "I'll loan you 8 demo tools Friday (free). Your main order ships Tuesday, arrives next Friday. You have tools Monday = zero downtime. Deal?" Client: "Yes!" Loan = 0 cost to Milwaukee, client started on time, order CLOSED at 95k. Delivery objection  trust builder.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flashcard-progress">
                    <h3>Progress: Przejrzane Obiekcje</h3>
                    <div class="progress-number" id="objectionProgress">0/6</div>
                    <div class="flashcard-buttons">
                        <button class="flashcard-btn primary" onclick="markAllObjectionsKnown()"> Znam wszystkie</button>
                        <button class="flashcard-btn" onclick="resetObjectionCards()"> Resetuj</button>
                    </div>
                </div>

                <div class="success-message" id="objectionSuccess"> Wszystkie obiekcje przejrzane! +20 XP</div>
            </div>

            <div class="insight-box">
                <strong> Master Framework:</strong> DON'T / SAY / ACTION / PROOF to twj playbook:<br><br>
                <strong>DON'T:</strong> Defensive, accusatory, instant cave = weakness signals<br>
                <strong>SAY:</strong> Empathize + Reframe + Offer alternatives = consultative approach<br>
                <strong>ACTION:</strong> Specific next steps (pilot, data, meeting) = move forward<br>
                <strong>PROOF:</strong> Real case study = credibility ("Mahle had same concern, here's what happened")<br><br>
                Pattern: <em>Acknowledge concern  Ask clarifying question  Offer 2-3 options  Back with data/proof</em>. Repeat 1000x = muscle memory.
            </div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 8: Role-Play Simulator -->
        <div class="card" id="card8">
            <div class="card-header">
                <div class="card-number">8/10</div>
                <h2 class="card-title"> Role-Play Simulator - 5-Turn Negotiation</h2>
                <p>Real scenario: Automotive Tier 1, 200k PLN deal, 3 stakeholders. Twoje decyzje wpywaj na outcome.</p>
            </div>

            <div class="roleplay-scenario">
                <h3> Scenario Brief:</h3>
                <p><strong>Client:</strong> Automotive Tier 1 supplier (Poland, 800 workers)</p>
                <p><strong>Deal Size:</strong> 200,000 PLN (Milwaukee M18 full line, 80 units + accessories)</p>
                <p><strong>Competitor:</strong> Bosch (incumbent 8 years, quoted 135,000 PLN)</p>
                <p><strong>Your Pilot Results:</strong> 4-week test on Line 3 - downtime 6h/month (vs Bosch 14h), workers love it</p>
                
                <div class="stakeholders">
                    <div class="stakeholder">
                        <span class="stakeholder-icon"></span>
                        <strong>Adam (Procurement):</strong> Price-focused, loyal to Bosch, skeptical
                    </div>
                    <div class="stakeholder">
                        <span class="stakeholder-icon"></span>
                        <strong>Zofia (CFO):</strong> ROI-focused, budget-conscious, data-driven
                    </div>
                    <div class="stakeholder">
                        <span class="stakeholder-icon"></span>
                        <strong>Marek (Production Manager):</strong> Your ally, wants Milwaukee, needs help convincing others
                    </div>
                </div>
            </div>

            <div class="roleplay-container" id="roleplayContainer">
                <!-- Dynamically rendered conversation -->
            </div>

            <div class="roleplay-end" id="roleplayEnd">
                <!-- Dynamically rendered ending -->
            </div>

            <div class="success-message" id="roleplaySuccess"> Role-play ukoczony! +15 XP</div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 9: Post-Negotiation Email Builder -->
        <div class="card" id="card9">
            <div class="card-header">
                <div class="card-number">9/10</div>
                <h2 class="card-title"> Post-Negotiation: 90-Day Partnership Plan</h2>
                <p>Deal signed? Real work begins. 90-day checklist + 3 email templates for stakeholder management.</p>
            </div>

            <div class="postneg-intro">
                <h3> Why This Matters:</h3>
                <p>80% of KAMs disappear after contract signing. Top 10% send follow-up emails to ALL stakeholders (CFO, PM, Procurement) + execute 90-day plan. This builds <strong>partnership</strong>, not transactional relationship. Renewal rate: 85% vs 40% (no follow-up).</p>
            </div>

            <div class="checklist-90day">
                <h3> 90-Day Partnership Checklist</h3>
                
                <div class="checklist-progress">
                    <div class="checklist-progress-bar">
                        <div class="checklist-progress-fill" id="checklistProgressFill" style="width: 0%;">0%</div>
                    </div>
                    <p id="checklistProgressText">0/10 completed (need 6/10 for XP)</p>
                </div>

                <div class="checklist-phase">
                    <h4> Week 1: Kickoff</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="check1" onchange="updateChecklistProgress()">
                        <label for="check1">Send thank-you emails to CFO, PM, and Procurement (use templates below)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check2" onchange="updateChecklistProgress()">
                        <label for="check2">Schedule kickoff meeting (PM + key stakeholders, confirm delivery date)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check3" onchange="updateChecklistProgress()">
                        <label for="check3">Confirm delivery logistics (who receives, where, when)</label>
                    </div>
                </div>

                <div class="checklist-phase">
                    <h4> Week 2-4: Implementation</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="check4" onchange="updateChecklistProgress()">
                        <label for="check4">Delivery complete + invoice sent (confirm PM received all items)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check5" onchange="updateChecklistProgress()">
                        <label for="check5">On-site training conducted (document attendees, collect feedback)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check6" onchange="updateChecklistProgress()">
                        <label for="check6">First usage report: Track downtime, defects, worker satisfaction (baseline data)</label>
                    </div>
                </div>

                <div class="checklist-phase">
                    <h4> Week 4-6: First Check-In</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="check7" onchange="updateChecklistProgress()">
                        <label for="check7">Call PM: "How's it going? Any issues?" (proactive problem-solving)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check8" onchange="updateChecklistProgress()">
                        <label for="check8">Address early issues immediately (warranty claims, training gaps, missing accessories)</label>
                    </div>
                </div>

                <div class="checklist-phase">
                    <h4> Week 8-12: Quarterly Business Review (QBR)</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="check9" onchange="updateChecklistProgress()">
                        <label for="check9">Schedule QBR with CFO + PM: Present ROI data (downtime reduction, cost savings vs. guarantee)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check10" onchange="updateChecklistProgress()">
                        <label for="check10">Discuss expansion opportunities (other lines, additional tools, training programs)</label>
                    </div>
                </div>
            </div>

            <div class="email-builder">
                <h3> Stakeholder Email Templates</h3>
                
                <div class="template-selector">
                    <label for="templateSelect">Select Template:</label>
                    <select id="templateSelect" onchange="selectEmailTemplate()">
                        <option value="">-- Choose email template --</option>
                        <option value="cfo">1. CFO Thank-You (ROI focus)</option>
                        <option value="pm">2. PM Partnership Vision (implementation roadmap)</option>
                        <option value="procurement">3. Procurement Thank-You (professional closure)</option>
                    </select>
                </div>

                <!-- CFO Template Inputs -->
                <div class="placeholder-inputs" id="inputs-cfo">
                    <div class="input-group">
                        <label for="cfo_name">CFO Name:</label>
                        <input type="text" id="cfo_name" placeholder="e.g., Zofia Kowalska" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="cfo_company">Company:</label>
                        <input type="text" id="cfo_company" placeholder="e.g., Automotive Tier 1 Sp. z o.o." oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="cfo_amount">Deal Amount (PLN):</label>
                        <input type="text" id="cfo_amount" placeholder="e.g., 200,000" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="cfo_delivery">Delivery Date:</label>
                        <input type="text" id="cfo_delivery" placeholder="e.g., March 15, 2026" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="cfo_start">ROI Tracking Start:</label>
                        <input type="text" id="cfo_start" placeholder="e.g., April 1, 2026" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="cfo_roi">Target Savings Year 1 (PLN):</label>
                        <input type="text" id="cfo_roi" placeholder="e.g., 35,000" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="cfo_yourname">Your Name:</label>
                        <input type="text" id="cfo_yourname" placeholder="e.g., Jan Nowak" oninput="updateEmailPreview()">
                    </div>
                </div>

                <!-- PM Template Inputs -->
                <div class="placeholder-inputs" id="inputs-pm">
                    <div class="input-group">
                        <label for="pm_name">PM Name:</label>
                        <input type="text" id="pm_name" placeholder="e.g., Marek Winiewski" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_company">Company:</label>
                        <input type="text" id="pm_company" placeholder="e.g., Automotive Tier 1 Sp. z o.o." oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_delivery">Delivery Date:</label>
                        <input type="text" id="pm_delivery" placeholder="e.g., March 15" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_teamsize">Team Size:</label>
                        <input type="text" id="pm_teamsize" placeholder="e.g., 25" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_metric">Key Metric to Track:</label>
                        <input type="text" id="pm_metric" placeholder="e.g., downtime reduction" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_goal">Target Goal:</label>
                        <input type="text" id="pm_goal" placeholder="e.g., <8h/month downtime" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_phone">Your Phone:</label>
                        <input type="text" id="pm_phone" placeholder="e.g., +48 600 123 456" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="pm_yourname">Your Name:</label>
                        <input type="text" id="pm_yourname" placeholder="e.g., Jan Nowak" oninput="updateEmailPreview()">
                    </div>
                </div>

                <!-- Procurement Template Inputs -->
                <div class="placeholder-inputs" id="inputs-procurement">
                    <div class="input-group">
                        <label for="proc_name">Procurement Name:</label>
                        <input type="text" id="proc_name" placeholder="e.g., Adam Kowalczyk" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_company">Company:</label>
                        <input type="text" id="proc_company" placeholder="e.g., Automotive Tier 1 Sp. z o.o." oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_po">PO Number:</label>
                        <input type="text" id="proc_po" placeholder="e.g., PO-2026-1234" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_amount">Amount (PLN):</label>
                        <input type="text" id="proc_amount" placeholder="e.g., 200,000" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_delivery">Delivery Date:</label>
                        <input type="text" id="proc_delivery" placeholder="e.g., March 15, 2026" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_terms">Payment Terms:</label>
                        <input type="text" id="proc_terms" placeholder="e.g., Net 90" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_invoice">Invoice Date:</label>
                        <input type="text" id="proc_invoice" placeholder="e.g., March 20, 2026" oninput="updateEmailPreview()">
                    </div>
                    <div class="input-group">
                        <label for="proc_yourname">Your Name:</label>
                        <input type="text" id="proc_yourname" placeholder="e.g., Jan Nowak" oninput="updateEmailPreview()">
                    </div>
                </div>

                <div class="email-preview" id="emailPreview">
                    <h4> Preview:</h4>
                    <div class="email-preview-subject" id="previewSubject"></div>
                    <div class="email-preview-body" id="previewBody"></div>
                </div>

                <div class="email-actions">
                    <button class="email-btn copy" id="copyBtn" onclick="copyToClipboard()" style="display: none;"> Copy to Clipboard</button>
                    <button class="email-btn mark-sent" id="markSentBtn" onclick="markEmailSent()" disabled style="display: none;"> Mark as Sent</button>
                    <button class="email-btn reset" onclick="resetEmailBuilder()"> Reset Builder</button>
                    <span class="copy-feedback" id="copyFeedback">Copied!</span>
                </div>
            </div>

            <div class="insight-box">
                <strong> Pro Tip:</strong> Send CFO email within 24h of contract signing (ROI focus). PM email Week 1 (partnership roadmap). Procurement email same day as invoice (professional closure). 90% of KAMs skip this - you won't. QBR at Week 8-12 = renewal conversation starts early. Top 10% KAMs treat post-sale like pre-sale.
            </div>

            <div class="success-message" id="postnegSuccess"> 90-Day Plan complete! +10 XP</div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
                <button class="nav-button btn-next" onclick="nextCard()">Nastpna </button>
            </div>
        </div>

        <!-- Card 10: Summary + Badge -->
        <div class="card" id="card10">
            <div class="card-header">
                <div class="card-number">10/10</div>
                <h2 class="card-title"> Podsumowanie: Master Negotiator</h2>
                <p>Gratulacje! Ukoczye Lesson 3. Oto co opanowae:</p>
            </div>

            <div class="summary-intro">
                <h3> Lesson 3 Complete!</h3>
                <p>You've mastered B2B negotiation WITHOUT price wars. You negotiate like TOP 10% KAMs - value first, price last, partnerships over transactions.</p>
            </div>

            <div class="learning-checklist">
                <h3> 8-Point Learning Checklist:</h3>
                
                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>1. ZOPA Framework Mastered</strong>
                        <p>You know YOUR BATNA (walk-away point) and THEIR BATNA. You find Zone of Possible Agreement instead of fighting over price. Reservation price vs Target price = negotiation map.</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>2. Negotiate Without Discounting (8 Scenarios)</strong>
                        <p>Pilot > discount. TCO > price. Value-add > cave. You practiced 8 real scenarios - competitor price wars, CFO guarantees, procurement pressure. 7-8/8 = Master level.</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>3. Value Stacking Expertise (8 Value-Adds)</strong>
                        <p>You built value stacks: low cost to you (500-3k PLN), high perceived value to client (3-12k PLN). Ratio >3 = no-brainer. Extended warranty, training, ONE-KEY, QBRs - these cost little, deliver big.</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>4. 5 Closing Techniques</strong>
                        <p>Assumptive, Alternative Choice, Urgency, Summary, Puppy Dog. You know WHEN to use each, HOW to script it, WHY it works, and WHEN NOT to use it. Examples: VW 180k (Assumptive), Mahle 140k (Alternative), KGHM price lock (Urgency).</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>5. 10 Contract Terms Balanced</strong>
                        <p>You negotiate 40-60% client-favorable = partnership, not vendor win. Payment terms (Net 30/45/90), volume commitments, price protection, exclusivity, SLAs, warranties, termination, performance guarantees, IP rights, auto-renewal. Trade-offs, not giveaways.</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>6. 6 Objection Handlers (DON'T/SAY/ACTION/PROOF)</strong>
                        <p>Competitor price wars, fixed discounts, internal pressure, firm pricing frustration, incumbent loyalty, delivery time. You learned what NOT to say (defensive, cave, accusatory), what TO say (scripts), ACTION steps (4-step playbooks), and PROOF (real case studies with PLN values).</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>7. Multi-Stakeholder Role-Play (3 Stakeholders, 5 Turns)</strong>
                        <p>You negotiated with Procurement (price-focused), CFO (ROI-focused), PM (downtime-focused). Coalition building: PM + CFO > Procurement. Pilot proves value. Conservative guarantees manage risk. Smart concessions (Net 90, QBRs) = low cost, high goodwill.</p>
                    </div>
                </div>

                <div class="learning-item">
                    <div class="learning-item-icon"></div>
                    <div class="learning-item-content">
                        <strong>8. Post-Close Partnership (90-Day Plan + 3 Emails)</strong>
                        <p>Deal signed? Real work begins. You send thank-you emails to CFO (ROI focus), PM (partnership roadmap), Procurement (professional closure). 90-day checklist: kickoff, delivery, training, check-ins, QBR. Renewal rate: 85% vs 40% (no follow-up).</p>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon"></div>
                    <div class="stat-value" id="finalXP">110</div>
                    <div class="stat-label">Total XP Earned</div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"></div>
                    <div class="stat-value">10/10</div>
                    <div class="stat-label">Cards Completed</div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"></div>
                    <div class="stat-value">~75 min</div>
                    <div class="stat-label">Time Invested</div>
                </div>
            </div>

            <button class="badge-reveal-btn" onclick="revealBadge()">
                Odbierz Badge  Deal Closer
            </button>

            <div class="next-lesson-cta">
                <h4> Lesson 4: Account Growth & Expansion</h4>
                <p>Coming soon... (Expand 100k client  500k strategic account)</p>
                <p style="margin-top: 10px; font-size: 0.9rem;"> Zablokowane - Dostpne po implementacji</p>
            </div>

            <div class="insight-box">
                <strong> Master Quote:</strong> "Top 1% KAM don't WIN negotiations. They make clients WANT to buy at premium pricing. How? ZOPA (know walk-away), Value Stack (create > claim), Pilot (prove > promise), Partnership (60% > 100% contract terms). Price is the LAST thing discussed, not the first. Master this = 60-80% close rate vs 30-40% average. You're not a vendor anymore - you're a strategic partner. Procurement respects you. CFO listens to you. Clients like you. PM trusts you. Next: Scale these accounts."
            </div>

            <div class="card-navigation">
                <button class="nav-button btn-prev" onclick="prevCard()"> Poprzednia</button>
            </div>
        </div>

    </div>

    <!-- Badge Overlay -->
    <div class="badge-overlay" id="badgeOverlay">
        <div class="badge-content">
            <button class="badge-close" onclick="closeBadge()"></button>
            <div class="badge-icon"></div>
            <div class="badge-title">Deal Closer</div>
            <div class="badge-message">
                You've mastered B2B negotiation.<br><br>
                 You negotiate without price wars<br>
                 You build value stacks (cost little, deliver big)<br>
                 You close with 5 proven techniques<br>
                 You balance contracts for partnerships<br>
                 Procurement respects you<br>
                 CFO listens to you<br>
                 Clients like you<br>
                 PM trusts you<br><br>
                <strong>You're not a vendor - you're a strategic partner.</strong><br><br>
                Next: Scale these accounts (Lesson 4: Account Growth & Expansion)
            </div>
        </div>
    </div>

    <script>
        // State Management
        let currentCard = 1;
        const totalCards = 10;
        let earnedXP = 0;
        let completedCards = new Set();

        const cardXPValues = {
            1: 5,   // Video
            2: 0,   // ZOPA Framework (educational, no XP)
            3: 20,  // Negotiation Simulator
            4: 15,  // Value Stacking
            5: 15,  // Closing Techniques
            6: 10,  // Contract Negotiation
            7: 20,  // Objection Handling
            8: 15,  // Role-Play Simulator
            9: 10,  // Post-Negotiation Email Builder
            10: 10  // Summary + Badge (completion bonus)
        };

        // Navigation
        function nextCard() {
            if (currentCard < totalCards) {
                currentCard++;
                showCard(currentCard);
                updateNavigation();
            }
        }

        function prevCard() {
            if (currentCard > 1) {
                currentCard--;
                showCard(currentCard);
                updateNavigation();
            }
        }

        function showCard(n) {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById('card' + n).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Initialize roleplay when reaching card 8
            if (n === 8) {
                loadRoleplayState();
            }

            // Update final XP display when reaching card 10
            if (n === 10) {
                document.getElementById('finalXP').textContent = earnedXP;
            }
        }

        function updateNavigation() {
            const prevBtn = document.querySelector('.btn-prev');
            const nextBtn = document.querySelector('.btn-next');

            if (prevBtn) prevBtn.disabled = currentCard === 1;
            if (nextBtn) nextBtn.disabled = currentCard === totalCards;
        }

        // Progress Tracking
        function updateProgress() {
            const progressPercent = (earnedXP / 120) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('currentXP').textContent = earnedXP;
        }

        // Save/Load progress
        function saveProgress() {
            const progress = {
                currentCard: currentCard,
                earnedXP: earnedXP,
                completedCards: Array.from(completedCards)
            };
            localStorage.setItem('lesson3Progress', JSON.stringify(progress));
        }

        function loadProgress() {
            const saved = localStorage.getItem('lesson3Progress');
            if (saved) {
                const progress = JSON.parse(saved);
                currentCard = progress.currentCard || 1;
                earnedXP = progress.earnedXP || 0;
                completedCards = new Set(progress.completedCards || []);
                
                showCard(currentCard);
                updateProgress();
                updateNavigation();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextCard();
            if (e.key === 'ArrowLeft') prevCard();
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            updateNavigation();
            
            // Load video reflection if exists
            const savedReflection = localStorage.getItem('videoReflection');
            if (savedReflection) {
                document.getElementById('videoReflection').value = savedReflection;
            }

            // Load video checkbox state
            const videoWatched = localStorage.getItem('videoWatched');
            if (videoWatched === 'true') {
                document.getElementById('videoWatched').checked = true;
            }
        });

        // ===== Card 1: Video Functions =====
        function toggleVideoCheckbox() {
            const checkbox = document.getElementById('videoWatched');
            
            if (checkbox.checked) {
                // Award XP (only once)
                if (!completedCards.has(1)) {
                    completedCards.add(1);
                    earnedXP += cardXPValues[1];
                    updateProgress();
                    saveProgress();
                    
                    // Show success message
                    const successMsg = document.getElementById('videoSuccess');
                    successMsg.classList.add('show');
                    setTimeout(() => {
                        successMsg.classList.remove('show');
                    }, 3000);
                }
                
                localStorage.setItem('videoWatched', 'true');
            } else {
                localStorage.setItem('videoWatched', 'false');
            }
        }

        function autoSaveReflection() {
            const reflection = document.getElementById('videoReflection').value;
            localStorage.setItem('videoReflection', reflection);
        }

        // ===== Card 3: Negotiation Simulator Functions =====
        const scenariosData = [
            {
                id: 1,
                situation: "Client: \"We need 20% discount or we're walking. Competitor offers us 80k for same spec.\"\nContext: You quoted 100k PLN for Milwaukee set. It's Day 2 of negotiation.",
                options: [
                    "Give 15% discount immediately to save the deal (85k PLN)",
                    "Match competitor at 80k and close today",
                    "Offer: 4-week pilot at 100k. If downtime >10h, we refund difference. If <10h, you pay full. Fair?",
                    "Counter: 95k, but only if they commit today and sign 3-year exclusive"
                ],
                correct: 2,
                feedback: {
                    correct: " Perfect! Pilot eliminates price objection (you prove value first), transfers risk to you (refund clause = confidence), and anchors 100k as fair price. 80% of pilots convert at target price because downtime proves ROI.",
                    incorrect: " Discounting without proof = margin loss forever. Competitor \"80k same spec\" is rarely true (check TCO, warranty, support). Pilot first, discount never (or last resort <5%)."
                }
            },
            {
                id: 2,
                situation: "CFO: \"I approved 120k budget, but CEO wants ROI guarantee. Can you guarantee 50k savings in Year 1?\"\nContext: Your ROI calc shows 35-45k savings (conservative). 50k = stretch but possible.",
                options: [
                    "Say YES to close the deal (you'll figure it out later)",
                    "Say NO, 50k unrealistic, offer 35k guarantee instead",
                    "Offer: We guarantee 35k savings Year 1 (conservative). If you hit 50k, we split upside 50/50 as discount Year 2. Deal?",
                    "Deflect: \"Guarantees are for vendors. We're partners. Let's do quarterly reviews instead.\""
                ],
                correct: 2,
                feedback: {
                    correct: " Brilliant! Conservative guarantee (35k = achievable) protects you. Upside split (50/50 on 50k) = client incentivized to optimize usage. You both win if ROI exceeds target. Partnership, not vendor.",
                    incorrect: " Never guarantee what you can't deliver (kills trust). Don't leave money on table (35k when 45k likely). Deflection = weak. Upside-sharing = confidence + alignment."
                }
            },
            {
                id: 3,
                situation: "Procurement: \"We run 3-vendor RFP. You, Bosch, DeWalt. Lowest price wins. Submit final by Friday.\"\nContext: You know Bosch will bid 70k (cheap upfront, high TCO). Your target: 100k.",
                options: [
                    "Bid 95k to undercut Bosch but stay profitable",
                    "Bid 100k and hope your pitch wins",
                    "Request meeting: \"RFP compares price, not TCO. Can we present 3-year total cost instead? I'll show 40k savings vs Bosch.\"",
                    "Decline RFP: \"We don't compete on price. Call us when you want value.\""
                ],
                correct: 2,
                feedback: {
                    correct: " Perfect! RFPs favor cheap vendors. Change the game = compare TCO (your strength). Meeting lets you present data, build coalition with PM/CFO (bypass Procurement). 70% of RFPs shift to TCO after this move.",
                    incorrect: " Bidding lower = race to bottom. Hoping = not strategy. Declining = arrogance (burns bridge). Shift evaluation criteria from price  value. That's power."
                }
            },
            {
                id: 4,
                situation: "PM (ally): \"I want Milwaukee, but Procurement says Bosch is \"good enough\" and 30k cheaper. Help me make the case.\"\nContext: PM loves Milwaukee (piloted it), but doesn't have budget authority. CFO + Procurement = decision.",
                options: [
                    "Give PM discount ammo: \"Tell them we'll match Bosch at 70k\"",
                    "Build coalition: \"Let's get CFO + you + me in room. I'll show 3-year TCO: Bosch 43k, Milwaukee 23k. You win 20k, I keep my price.\"",
                    "Ask PM to escalate to CEO: \"This is strategic decision, not Procurement call\"",
                    "Send ROI calc to PM and hope he convinces them"
                ],
                correct: 1,
                feedback: {
                    correct: " Perfect! Multi-stakeholder = coalition strategy. CFO cares about TCO (show 20k savings). PM cares about downtime (show 15h/yr saved). You = facilitator, not vendor. Meeting format lets you control narrative. 85% close rate.",
                    incorrect: " Discount = lost margin + no differentiation. CEO escalation = PM loses face. Sending calc = passive (no Q&A, no objection handling). Active coalition > passive hope."
                }
            },
            {
                id: 5,
                situation: "Client: \"Your price is firm at 100k? Zero flexibility? That's insulting. Bosch negotiates.\"\nContext: You're at 100k (target). Client frustrated by \"no discount\" approach. Relationship tense.",
                options: [
                    "Cave: \"OK, 7% off if you sign today (93k PLN)\"",
                    "Reframe: \"I have flexibility on TERMS, not PRICE. What's more valuable: 5k discount or Net 60 payment + free training?\"",
                    "Stand firm: \"Price is price. Quality costs. Take it or leave it.\"",
                    "Offer: \"90k if you commit to 3-year contract with 10% annual growth\""
                ],
                correct: 1,
                feedback: {
                    correct: " Brilliant! Price firm, but terms flexible = value creation. Net 60 costs you 800 PLN (finance cost), client perceives 4k value (cash flow). Training costs 3k, perceived 12k. You \"negotiate\" without discounting. Win-win.",
                    incorrect: " Caving = weak (client will push more). Standing firm = arrogant (kills relationship). Multi-year lock-in = risky (client might churn). Terms flexibility = price integrity + client satisfaction."
                }
            },
            {
                id: 6,
                situation: "Client: \"We'll buy 50k PLN now, then 50k in 6 months if we're happy. Splits the risk.\"\nContext: You want 100k upfront (cash flow + commitment). Client wants trial period.",
                options: [
                    "Accept: 50k now, 50k later (guaranteed revenue, low risk)",
                    "Counter: \"100k now, but 120-day payment terms (Net 120). You get 4-month float, I get commitment.\"",
                    "Offer: \"75k now + 25k in 3 months (after pilot). If downtime >15h, you walk. If <15h, you pay 25k + order another 50k. Deal?\"",
                    "Decline: \"We don't do split deals. 100k or no deal.\""
                ],
                correct: 2,
                feedback: {
                    correct: " Smart! 75/25 split = client feels protected (25k at risk, not 100k), you get majority upfront (75k cash flow). Pilot = proof period (3 months realistic). Upside clause (order 50k more) = expansion opportunity. Creative!",
                    incorrect: " 50/50 split = too much risk (client can ghost after 6mo). Net 120 = cash flow pain for you. Declining = inflexible. 75/25 + pilot + upside = balanced risk + growth."
                }
            },
            {
                id: 7,
                situation: "CEO (new stakeholder): \"I heard you're asking 100k. Our VP Ops says 70k is market rate. Justify the premium.\"\nContext: VP Ops = Procurement ally (wants Bosch). CEO = final decision. This is your shot.",
                options: [
                    "Defend: \"Milwaukee is premium brand. You get what you pay for.\"",
                    "Pivot: \"CEO, what's your #1 priority: upfront cost or 3-year profitability?\" (Let him answer, then show TCO)",
                    "Discount: \"For you, 85k. Final offer.\"",
                    "Attack: \"70k Bosch = 15h downtime/yr = 12k lost productivity. You'd lose 36k over 3yr to save 30k upfront. Smart?\""
                ],
                correct: 1,
                feedback: {
                    correct: " Perfect! Question flips script = CEO thinks about HIS priority (profitability, not price). 90% say profitability. Then you show TCO: 100k Milwaukee = 23k total cost, 70k Bosch = 43k. CEO sees 20k savings. You win at 100k.",
                    incorrect: " \"Premium brand\" = weak (no data). Discount = lost margin. Attack = defensive (alienates VP Ops). Question  Listen  Data = consultative selling. CEO respects this."
                }
            },
            {
                id: 8,
                situation: "Final negotiation. Client: \"Meet us at 90k and we'll sign today. 100k needs another approval round (2 weeks). Your call.\"\nContext: 90k = margin OK but below target. 100k = 2 weeks delay risk (competitor might swoop).",
                options: [
                    "Take 90k today (bird in hand, close now)",
                    "Hold 100k, risk 2-week delay (stand firm on value)",
                    "Counter: \"95k today, or 100k in 2 weeks + I throw in 5k training package. You choose.\"",
                    "Say: \"I'll ask my manager\" (buy time to think)"
                ],
                correct: 2,
                feedback: {
                    correct: " Excellent! Alternative close = client feels in control (choose A or B). 95k today = quick close, you keep 95% of target. 100k + training = value-add (costs you 3k, perceived 5k), total value 105k. Either way you win. Choice architecture!",
                    incorrect: " Taking 90k = leaving 10k on table (5% margin loss). Holding 100k = risky (2 weeks = competitor time). \"Ask manager\" = weak. Alternatives = power (client picks their win, you control options)."
                }
            }
        ];

        let scenarioAnswers = new Array(scenariosData.length).fill(null);

        function renderScenarios() {
            const container = document.getElementById('scenarioContainer');
            container.innerHTML = '';

            scenariosData.forEach((scenario, index) => {
                const scenarioBox = document.createElement('div');
                scenarioBox.className = 'scenario-box';
                scenarioBox.innerHTML = `
                    <div class="scenario-header">
                        <div class="scenario-number">Scenario ${scenario.id}/8</div>
                        <div class="scenario-status" id="status${index}"></div>
                    </div>
                    <div class="scenario-situation">
                        <strong>Situation:</strong><br>
                        ${scenario.situation.replace(/\n/g, '<br>')}
                    </div>
                    <div class="scenario-options" id="options${index}">
                        ${scenario.options.map((opt, optIdx) => `
                            <button class="option-btn" onclick="selectScenarioOption(${index}, ${optIdx})">
                                <span class="option-letter">${String.fromCharCode(65 + optIdx)}.</span>
                                <span>${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                    <div class="scenario-feedback" id="feedback${index}"></div>
                `;
                container.appendChild(scenarioBox);
            });

            // Restore saved answers
            const saved = localStorage.getItem('scenarioAnswers');
            if (saved) {
                scenarioAnswers = JSON.parse(saved);
                scenarioAnswers.forEach((answer, idx) => {
                    if (answer !== null) {
                        restoreScenarioAnswer(idx, answer);
                    }
                });
            }
        }

        function selectScenarioOption(scenarioIdx, optionIdx) {
            const scenario = scenariosData[scenarioIdx];
            const isCorrect = optionIdx === scenario.correct;
            
            // Save answer
            scenarioAnswers[scenarioIdx] = optionIdx;
            localStorage.setItem('scenarioAnswers', JSON.stringify(scenarioAnswers));

            // Update UI
            const optionsContainer = document.getElementById(`options${scenarioIdx}`);
            const buttons = optionsContainer.querySelectorAll('.option-btn');
            
            buttons.forEach((btn, idx) => {
                btn.classList.add('disabled');
                if (idx === optionIdx) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
                if (idx === scenario.correct) {
                    btn.classList.add('correct');
                }
            });

            // Show feedback
            const feedbackDiv = document.getElementById(`feedback${scenarioIdx}`);
            feedbackDiv.className = `scenario-feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackDiv.innerHTML = `
                <h4>${isCorrect ? ' Correct!' : ' Not the best choice'}</h4>
                <p>${isCorrect ? scenario.feedback.correct : scenario.feedback.incorrect}</p>
            `;

            // Update status
            document.getElementById(`status${scenarioIdx}`).textContent = isCorrect ? '' : '';

            // Check if all scenarios completed
            if (scenarioAnswers.every(a => a !== null)) {
                setTimeout(() => showScenarioScore(), 500);
            }
        }

        function restoreScenarioAnswer(scenarioIdx, optionIdx) {
            const scenario = scenariosData[scenarioIdx];
            const isCorrect = optionIdx === scenario.correct;

            const optionsContainer = document.getElementById(`options${scenarioIdx}`);
            const buttons = optionsContainer.querySelectorAll('.option-btn');
            
            buttons.forEach((btn, idx) => {
                btn.classList.add('disabled');
                if (idx === optionIdx) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
                if (idx === scenario.correct) {
                    btn.classList.add('correct');
                }
            });

            const feedbackDiv = document.getElementById(`feedback${scenarioIdx}`);
            feedbackDiv.className = `scenario-feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackDiv.innerHTML = `
                <h4>${isCorrect ? ' Correct!' : ' Not the best choice'}</h4>
                <p>${isCorrect ? scenario.feedback.correct : scenario.feedback.incorrect}</p>
            `;

            document.getElementById(`status${scenarioIdx}`).textContent = isCorrect ? '' : '';
        }

        function showScenarioScore() {
            const correctCount = scenarioAnswers.filter((answer, idx) => 
                answer === scenariosData[idx].correct
            ).length;

            const scoreDisplay = document.getElementById('scenarioScore');
            const scoreValue = document.getElementById('scoreValue');
            const scoreInterpretation = document.getElementById('scoreInterpretation');

            scoreValue.textContent = `${correctCount}/8`;

            let interpretation = '';
            if (correctCount >= 7) {
                interpretation = ' Master Negotiator! You understand value creation, coalition building, and never discount without reason. Top 10% KAM material.';
            } else if (correctCount >= 5) {
                interpretation = ' Solid Skills! You grasp key concepts but sometimes default to discounting. Review scenarios where you lost points - pattern?';
            } else if (correctCount >= 3) {
                interpretation = ' Need Practice. You\'re giving away too much margin. Focus on: BATNA identification, value stacking, and multi-stakeholder coalition. Retry!';
            } else {
                interpretation = ' Danger Zone. You\'re negotiating like Procurement wants (price only). Review ZOPA framework + all feedback. This costs you 15-20% margin per deal.';
            }

            scoreInterpretation.textContent = interpretation;
            scoreDisplay.classList.add('show');
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Award XP (only once)
            if (!completedCards.has(3)) {
                completedCards.add(3);
                earnedXP += cardXPValues[3];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('scenarioSuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }
        }

        // ===== Card 4: Value Stacking Functions =====
        const valueAdds = [
            { name: 'Extended Warranty', cost: 2000, perceived: 8000 },
            { name: 'On-site Training', cost: 3000, perceived: 12000 },
            { name: 'ONE-KEY Setup', cost: 1500, perceived: 8000 },
            { name: 'Spare Battery Pack', cost: 2500, perceived: 6000 },
            { name: 'Priority Support', cost: 1000, perceived: 5000 },
            { name: 'Flexible Payment', cost: 800, perceived: 4000 },
            { name: 'Quarterly Reviews', cost: 1200, perceived: 6000 },
            { name: 'Case Study Rights', cost: 500, perceived: 3000 }
        ];

        function calculateValueStack() {
            let totalCost = 0;
            let totalPerceived = 0;
            let selectedCount = 0;
            const selectedNames = [];

            valueAdds.forEach((item, idx) => {
                const checkbox = document.getElementById(`value${idx}`);
                const option = document.getElementById(`valueOption${idx}`);
                
                if (checkbox.checked) {
                    totalCost += item.cost;
                    totalPerceived += item.perceived;
                    selectedCount++;
                    selectedNames.push(item.name);
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });

            // Update displays
            document.getElementById('totalCost').textContent = totalCost.toLocaleString('pl-PL') + ' PLN';
            document.getElementById('perceivedValue').textContent = totalPerceived.toLocaleString('pl-PL') + ' PLN';
            
            const ratio = totalCost > 0 ? (totalPerceived / totalCost).toFixed(1) : 0;
            document.getElementById('valueRatio').textContent = ratio + '';

            // Generate statement
            if (selectedCount >= 3 && ratio >= 2.5) {
                const statementDiv = document.getElementById('generatedStatement');
                const statementText = document.getElementById('statementText');
                
                statementText.innerHTML = `
                    <strong>Email to Client:</strong><br><br>
                    "Thank you for the Bosch comparison at 102k PLN. I understand the 18k price gap concern.<br><br>
                    
                    Instead of matching their price, I'd like to propose a <strong>value package at our 120k investment</strong> that delivers significantly more:<br><br>
                    
                    <strong>Included at no extra charge:</strong><br>
                    ${selectedNames.map(name => ` ${name}`).join('<br>')}<br><br>
                    
                    <strong>Total package value: ${(120000 + totalPerceived).toLocaleString('pl-PL')} PLN</strong> (120k tools + ${totalPerceived.toLocaleString('pl-PL')} services)<br>
                    Your effective cost per value: <strong>${((120000 / (120000 + totalPerceived)) * 100).toFixed(0)}%</strong> (vs. Bosch 100% price, 0% services)<br><br>
                    
                    This isn't about matching price - it's about <strong>maximizing your ROI</strong> while eliminating risk (warranty), accelerating adoption (training), and ensuring long-term success (support + reviews).<br><br>
                    
                    Can we schedule 30-min call to walk through the TCO comparison? I believe you'll see 25-35k savings over 3 years vs. the \"cheaper\" option.<br><br>
                    
                    Best regards,<br>
                    [Your Name], Milwaukee KAM"
                `;
                
                statementDiv.style.display = 'block';
                document.getElementById('saveValueBtn').disabled = false;
            } else {
                document.getElementById('generatedStatement').style.display = 'none';
                document.getElementById('saveValueBtn').disabled = true;
            }

            // Save to localStorage
            localStorage.setItem('valueStackSelections', JSON.stringify(
                valueAdds.map((_, idx) => document.getElementById(`value${idx}`).checked)
            ));
        }

        function saveValueStack() {
            // Award XP (only once)
            if (!completedCards.has(4)) {
                completedCards.add(4);
                earnedXP += cardXPValues[4];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('valueSuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }
        }

        // ===== Card 10: Summary + Badge Functions =====
        function revealBadge() {
            // Award completion bonus XP (only once)
            if (!completedCards.has(10)) {
                completedCards.add(10);
                earnedXP += cardXPValues[10];
                updateProgress();
                saveProgress();
                
                // Update final XP display
                document.getElementById('finalXP').textContent = earnedXP;
            }

            // Show badge overlay
            document.getElementById('badgeOverlay').classList.add('show');
        }

        function closeBadge() {
            document.getElementById('badgeOverlay').classList.remove('show');
        }

        // ===== Card 9: Post-Negotiation Email Builder Functions =====
        const emailTemplates = {
            cfo: {
                subject: 'Thank you for partnership - {{COMPANY}}',
                body: `Dear {{CFO_NAME}},

Thank you for approving our {{AMOUNT}} PLN investment in Milwaukee tools for {{COMPANY}}.

Our commitment to you:
 Delivery by {{DELIVERY_DATE}}
 ROI tracking starting {{START_DATE}}
 Target: {{ROI_AMOUNT}} PLN savings Year 1
 Quarterly reviews to validate progress

Looking forward to proving the value you believed in.

Best regards,
{{YOUR_NAME}}
Milwaukee Key Account Manager`,
                fields: ['CFO_NAME', 'COMPANY', 'AMOUNT', 'DELIVERY_DATE', 'START_DATE', 'ROI_AMOUNT', 'YOUR_NAME']
            },
            pm: {
                subject: 'Partnership roadmap - {{COMPANY}}',
                body: `Hi {{PM_NAME}},

Excited to start our partnership! Quick roadmap:

Week 1: Delivery + kickoff ({{DELIVERY_DATE}})
Week 2: On-site training for {{TEAM_SIZE}} team members
Week 4: First check-in - how's it going?
Week 8: QBR - validate {{METRIC}} improvement

My cell: {{PHONE}} (call anytime with issues)

We're in this together. Let's crush that {{GOAL}} target.

{{YOUR_NAME}}
Milwaukee Key Account Manager`,
                fields: ['PM_NAME', 'COMPANY', 'DELIVERY_DATE', 'TEAM_SIZE', 'METRIC', 'GOAL', 'PHONE', 'YOUR_NAME']
            },
            procurement: {
                subject: 'Contract executed - {{COMPANY}}',
                body: `Dear {{PROCUREMENT_NAME}},

Contract received and executed. Details:

 PO Number: {{PO_NUMBER}}
 Amount: {{AMOUNT}} PLN
 Delivery: {{DELIVERY_DATE}}
 Payment terms: {{PAYMENT_TERMS}}

Invoice will be sent {{INVOICE_DATE}}.

Thank you for professional negotiation process. Looking forward to long-term partnership.

Best regards,
{{YOUR_NAME}}
Milwaukee Key Account Manager`,
                fields: ['PROCUREMENT_NAME', 'COMPANY', 'PO_NUMBER', 'AMOUNT', 'DELIVERY_DATE', 'PAYMENT_TERMS', 'INVOICE_DATE', 'YOUR_NAME']
            }
        };

        let currentTemplate = '';
        let checklistData = [];

        function selectEmailTemplate() {
            const select = document.getElementById('templateSelect');
            currentTemplate = select.value;

            // Hide all input forms
            document.querySelectorAll('.placeholder-inputs').forEach(form => {
                form.classList.remove('show');
            });

            // Show selected form
            if (currentTemplate) {
                const inputsDiv = document.getElementById(`inputs-${currentTemplate}`);
                if (inputsDiv) {
                    inputsDiv.classList.add('show');
                }
                updateEmailPreview();
            } else {
                document.getElementById('emailPreview').classList.remove('show');
                document.getElementById('copyBtn').style.display = 'none';
                document.getElementById('markSentBtn').style.display = 'none';
            }
        }

        function updateEmailPreview() {
            if (!currentTemplate) return;

            const template = emailTemplates[currentTemplate];
            const previewDiv = document.getElementById('emailPreview');
            const subjectDiv = document.getElementById('previewSubject');
            const bodyDiv = document.getElementById('previewBody');
            const copyBtn = document.getElementById('copyBtn');
            const markSentBtn = document.getElementById('markSentBtn');

            // Get input values
            const inputs = {};
            let allFilled = true;
            
            const formPrefix = currentTemplate;
            template.fields.forEach(field => {
                const inputId = `${formPrefix}_${field.toLowerCase().replace(/_/g, '')}`.replace('cfoyourname', 'cfo_yourname').replace('pmyourname', 'pm_yourname').replace('procyourname', 'proc_yourname').replace('cfoname', 'cfo_name').replace('cfoccompany', 'cfo_company').replace('cfoamount', 'cfo_amount').replace('cfodelivery', 'cfo_delivery').replace('cfostart', 'cfo_start').replace('cforoi', 'cfo_roi').replace('pmname', 'pm_name').replace('pmcompany', 'pm_company').replace('pmdelivery', 'pm_delivery').replace('pmteamsize', 'pm_teamsize').replace('pmmetric', 'pm_metric').replace('pmgoal', 'pm_goal').replace('pmphone', 'pm_phone').replace('procname', 'proc_name').replace('proccompany', 'proc_company').replace('procpo', 'proc_po').replace('procamount', 'proc_amount').replace('procdelivery', 'proc_delivery').replace('procterms', 'proc_terms').replace('procinvoice', 'proc_invoice');
                
                const input = document.getElementById(inputId);
                if (input) {
                    const value = input.value.trim();
                    inputs[field] = value || `<span class="placeholder-missing">{{${field}}}</span>`;
                    if (!value) allFilled = false;
                } else {
                    inputs[field] = `<span class="placeholder-missing">{{${field}}}</span>`;
                    allFilled = false;
                }
            });

            // Replace placeholders in subject
            let subject = template.subject;
            Object.keys(inputs).forEach(key => {
                const regex = new RegExp(`{{${key}}}`, 'g');
                subject = subject.replace(regex, inputs[key]);
            });

            // Replace placeholders in body
            let body = template.body;
            Object.keys(inputs).forEach(key => {
                const regex = new RegExp(`{{${key}}}`, 'g');
                body = body.replace(regex, inputs[key]);
            });

            // Update preview
            subjectDiv.innerHTML = `<strong>Subject:</strong> ${subject}`;
            bodyDiv.innerHTML = body;
            previewDiv.classList.add('show');
            copyBtn.style.display = 'inline-block';
            markSentBtn.style.display = 'inline-block';
            markSentBtn.disabled = !allFilled;

            // Save to localStorage
            saveEmailBuilderState();
        }

        function copyToClipboard() {
            const subjectDiv = document.getElementById('previewSubject');
            const bodyDiv = document.getElementById('previewBody');
            
            // Get text content (strip HTML)
            const subject = subjectDiv.textContent;
            const body = bodyDiv.textContent;
            const fullEmail = `${subject}\n\n${body}`;

            navigator.clipboard.writeText(fullEmail).then(() => {
                const feedback = document.getElementById('copyFeedback');
                feedback.classList.add('show');
                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 2000);
            });
        }

        function markEmailSent() {
            if (!currentTemplate) return;

            // Mark corresponding checklist item (Week 1, check1)
            const check1 = document.getElementById('check1');
            if (!check1.checked) {
                check1.checked = true;
                updateChecklistProgress();
            }

            // Show confirmation
            alert(` Email marked as sent!\n\nTemplate: ${currentTemplate.toUpperCase()}\n\nDon't forget to send to actual recipient!`);
            
            // Reset builder
            resetEmailBuilder();
        }

        function resetEmailBuilder() {
            document.getElementById('templateSelect').value = '';
            currentTemplate = '';
            
            // Clear all inputs
            document.querySelectorAll('.placeholder-inputs input').forEach(input => {
                input.value = '';
            });

            // Hide forms and preview
            document.querySelectorAll('.placeholder-inputs').forEach(form => {
                form.classList.remove('show');
            });
            document.getElementById('emailPreview').classList.remove('show');
            document.getElementById('copyBtn').style.display = 'none';
            document.getElementById('markSentBtn').style.display = 'none';

            saveEmailBuilderState();
        }

        function updateChecklistProgress() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const total = checkboxes.length;
            let completed = 0;

            checkboxes.forEach((checkbox, idx) => {
                const item = checkbox.closest('.checklist-item');
                if (checkbox.checked) {
                    item.classList.add('completed');
                    completed++;
                } else {
                    item.classList.remove('completed');
                }
            });

            const percentage = Math.round((completed / total) * 100);
            const progressFill = document.getElementById('checklistProgressFill');
            const progressText = document.getElementById('checklistProgressText');

            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
            progressText.textContent = `${completed}/${total} completed (need 6/10 for XP)`;

            // Award XP if 60% complete (6/10)
            if (completed >= 6 && !completedCards.has(9)) {
                completedCards.add(9);
                earnedXP += cardXPValues[9];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('postnegSuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }

            saveChecklistState();
        }

        function saveChecklistState() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const states = [];
            checkboxes.forEach(cb => {
                states.push(cb.checked);
            });
            localStorage.setItem('checklistStates', JSON.stringify(states));
        }

        function loadChecklistState() {
            const saved = localStorage.getItem('checklistStates');
            if (saved) {
                const states = JSON.parse(saved);
                const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
                checkboxes.forEach((cb, idx) => {
                    if (states[idx] !== undefined) {
                        cb.checked = states[idx];
                    }
                });
                updateChecklistProgress();
            }
        }

        function saveEmailBuilderState() {
            const builderState = {
                currentTemplate: currentTemplate,
                inputs: {}
            };

            // Save all input values
            document.querySelectorAll('.placeholder-inputs input').forEach(input => {
                builderState.inputs[input.id] = input.value;
            });

            localStorage.setItem('emailBuilderState', JSON.stringify(builderState));
        }

        function loadEmailBuilderState() {
            const saved = localStorage.getItem('emailBuilderState');
            if (saved) {
                const state = JSON.parse(saved);
                
                if (state.currentTemplate) {
                    document.getElementById('templateSelect').value = state.currentTemplate;
                    currentTemplate = state.currentTemplate;
                    
                    const inputsDiv = document.getElementById(`inputs-${currentTemplate}`);
                    if (inputsDiv) {
                        inputsDiv.classList.add('show');
                    }
                }

                // Restore input values
                Object.keys(state.inputs).forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.value = state.inputs[inputId];
                    }
                });

                if (currentTemplate) {
                    updateEmailPreview();
                }
            }
        }

        // ===== Card 8: Role-Play Simulator Functions =====
        let roleplayState = {
            currentTurn: 'turn1',
            score: 0,
            path: [],
            ended: false
        };

        const roleplayData = {
            turn1: {
                turnNumber: 1,
                speaker: { icon: '', name: 'Adam (Procurement)', role: 'Budget Guardian' },
                quote: '"OK, pilot results look good - 6h downtime vs 14h with Bosch. But you\'re asking 200k and Bosch offered us 135k for renewal. That\'s 65k difference. I can\'t justify that to my CEO. Match Bosch or we\'re staying put."',
                context: 'First objection. Adam is price-focused and hasn\'t seen TCO data yet.',
                options: [
                    {
                        letter: 'A',
                        text: 'Offer immediate 15% discount (170k PLN) to close gap',
                        impact: 'Quick concession, but signals weakness',
                        next: 'turn2_discount',
                        score: 5,
                        feedback: ' Weak move. You gave 30k discount without defending value. Adam now knows you have margin to play with - he\'ll push for more. CFO will expect further discounts. Score: +5 (you\'re still in game, but lost leverage)'
                    },
                    {
                        letter: 'B',
                        text: 'Show TCO breakdown: "Bosch 135k upfront = 210k total cost (3yr). Milwaukee 200k = 165k total. You save 45k."',
                        impact: 'Data-driven, shifts conversation to value',
                        next: 'turn2_tco',
                        score: 25,
                        feedback: ' Strong! You reframed from price to TCO. Adam can\'t argue with math. CFO will love this (ROI focus). Marek smiles (you just armed him with data). Score: +25 (excellent positioning)'
                    },
                    {
                        letter: 'C',
                        text: '"I\'ll check with my manager if we can match 135k. Give me 2 days."',
                        impact: 'Stalling tactic, shows lack of confidence',
                        next: 'turn2_stall',
                        score: 10,
                        feedback: ' Mediocre. You delayed without offering solution. Adam thinks you\'re weak (need manager approval). Competitor has 2 days to counter. CFO annoyed (why wasn\'t this prepared?). Score: +10 (still alive, but momentum lost)'
                    }
                ],
                type: 'choice'
            },
            turn2_tco: {
                turnNumber: 2,
                speaker: { icon: '', name: 'Zofia (CFO)', role: 'ROI Analyst' },
                quote: '"Interesting TCO math. But I need guarantee. Your pilot showed 6h downtime - what if it jumps to 10h in real production? Then your 45k savings disappear. Can you guarantee 30k minimum savings Year 1, or is this just sales talk?"',
                context: 'CFO enters. She\'s intrigued by TCO but needs risk mitigation. Performance guarantee question.',
                options: [
                    {
                        letter: 'A',
                        text: 'Guarantee 50k savings Year 1 or 20% refund (aggressive commitment)',
                        impact: 'Bold, but risky if downtime varies',
                        next: 'turn3_aggressive',
                        score: 15,
                        feedback: ' Risky! 50k guarantee when pilot showed 45k potential = low margin for error. CFO impressed by confidence, but if you miss, you lose 40k refund + credibility. Score: +15 (high risk, high reward)'
                    },
                    {
                        letter: 'B',
                        text: 'Guarantee 30k savings Year 1 (conservative, pilot-based). If <30k, 10% credit Year 2.',
                        impact: 'Safe, data-backed, builds trust',
                        next: 'turn3_conservative',
                        score: 30,
                        feedback: ' Perfect! 30k = conservative (pilot showed 45k, you buffer 15k). 10% credit Year 2 = low risk for you (not immediate refund). CFO: "That\'s reasonable." Marek nods (you\'re credible). Score: +30 (excellent risk management)'
                    },
                    {
                        letter: 'C',
                        text: 'No guarantees - product sold as-is. Pilot results speak for themselves.',
                        impact: 'Firm stance, but increases CFO\'s perceived risk',
                        next: 'turn3_noguarantee',
                        score: 5,
                        feedback: ' Weak! CFO wanted risk transfer, you offered zero. Adam: "See? They won\'t back their claims." Marek can\'t defend this. You\'re now in price war territory. Score: +5 (major setback)'
                    }
                ],
                type: 'choice'
            },
            turn2_discount: {
                turnNumber: 2,
                speaker: { icon: '', name: 'Adam (Procurement)', role: 'Budget Guardian' },
                quote: '"170k is better, but still 35k more than Bosch. And you gave 15% in 30 seconds - makes me think there\'s more margin. How about 150k and we sign today?"',
                context: 'Adam smells weakness. He\'s pushing for more discount. You\'re in price war now.',
                options: [
                    {
                        letter: 'A',
                        text: 'Accept 150k to close deal today (total 25% discount)',
                        impact: 'Deal closes but at terrible margin',
                        next: 'ending_lowmargin',
                        score: 10,
                        feedback: ' You caved to 150k (50k discount). Deal closed but margin destroyed. CFO didn\'t even engage (no value discussion). You\'ll hit quota but at what cost? Score: +10. TOTAL: 15/100 - FAILED PATH'
                    },
                    {
                        letter: 'B',
                        text: 'Hold at 170k: "That\'s my final offer. 170k or we walk."',
                        impact: 'Firm stance, but no value justification',
                        next: 'ending_standoff',
                        score: 5,
                        feedback: ' Stalemate. Adam: "OK, we\'re staying with Bosch." You lost deal by being rigid without offering value. Should\'ve pivoted to TCO. Score: +5. TOTAL: 10/100 - FAILED PATH'
                    },
                    {
                        letter: 'C',
                        text: 'Pivot to TCO: "Let me show you why 170k is actually cheaper than Bosch 135k over 3 years..."',
                        impact: 'Late recovery attempt with data',
                        next: 'turn3_latevalue',
                        score: 20,
                        feedback: ' Recovery move! You finally bring TCO to table. Adam: "Why didn\'t you show this first?" CFO enters conversation. You\'re back in game but credibility damaged. Score: +20 (salvage mode)'
                    }
                ],
                type: 'choice'
            },
            turn2_stall: {
                turnNumber: 2,
                speaker: { icon: '', name: 'Marek (PM)', role: 'Your Ally' },
                quote: '(Pulls you aside after meeting) "Hey, I want Milwaukee but you\'re losing them. Adam\'s already calling Bosch for counter-offer. Zofia (CFO) hasn\'t even engaged yet. You need to bring DATA - TCO comparison, ROI calc. Can you come back tomorrow with business case?"',
                context: 'Marek is coaching you. He\'s giving you second chance. This is a rescue.',
                options: [
                    {
                        letter: 'A',
                        text: 'Return tomorrow with full TCO deck + conservative guarantee (30k savings)',
                        impact: 'Professional recovery, data-driven approach',
                        next: 'turn3_recovery',
                        score: 20,
                        feedback: ' Good recovery! You listened to Marek, came prepared. CFO appreciates data. Adam still skeptical but you\'re back in fight. Lost momentum but regained credibility. Score: +20 (second chance seized)'
                    },
                    {
                        letter: 'B',
                        text: 'Offer 20% discount (160k) via email to speed things up',
                        impact: 'Desperation move, no value defense',
                        next: 'ending_desperation',
                        score: 5,
                        feedback: ' Desperation! You discounted MORE without meeting CFO. Adam forwarded to Bosch: "Match this." Bosch dropped to 130k. You lost deal + damaged brand. Score: +5. TOTAL: 15/100 - FAILED PATH'
                    }
                ],
                type: 'choice'
            },
            turn3_conservative: {
                turnNumber: 3,
                speaker: { icon: '', name: 'Marek (PM)', role: 'Your Ally' },
                quote: '"Perfect! Zofia, this 30k guarantee covers our risk. And I\'ve seen the pilot data - we\'ll likely hit 40-45k savings, so 30k is conservative. Adam, I know 200k feels high, but losing 15k/month to downtime (current state) is costing us 180k/year. This pays for itself in 13 months."',
                context: 'Marek is now your champion. He\'s selling FOR you using your data. This is coalition building.',
                options: [
                    {
                        letter: 'A',
                        text: 'Let Marek continue. Stay silent and let internal champion close.',
                        impact: 'Trust your ally, don\'t oversell',
                        next: 'turn4_champion',
                        score: 25,
                        feedback: ' Smart! You armed Marek with data, now let him sell internally. CFO and Adam listen more to peer than vendor. You\'re consultative, not pushy. Score: +25 (coalition mastery)'
                    },
                    {
                        letter: 'B',
                        text: 'Jump in: "And we can add free training + 5yr warranty to sweeten the deal!"',
                        impact: 'Eager to help, but might undercut Marek\'s momentum',
                        next: 'turn4_oversell',
                        score: 10,
                        feedback: ' Overeager! Marek was closing, you interrupted with giveaways. Adam: "Wait, free training? What else can you throw in?" You re-opened negotiation. Score: +10 (momentum lost)'
                    }
                ],
                type: 'choice'
            },
            turn3_aggressive: {
                turnNumber: 3,
                speaker: { icon: '', name: 'Zofia (CFO)', role: 'ROI Analyst' },
                quote: '"50k guarantee is bold. I like confidence. But 20% refund if you miss = only 40k back on 200k deal. That\'s 160k risk for me. Make it 30% refund or lower the guarantee to 35k. Your call."',
                context: 'CFO is negotiating your guarantee terms. She\'s testing your confidence vs flexibility.',
                options: [
                    {
                        letter: 'A',
                        text: 'Accept 30% refund (60k risk if you miss 50k target)',
                        impact: 'Shows confidence, but massive downside',
                        next: 'turn4_highrisk',
                        score: 15,
                        feedback: ' Very risky! 30% refund = 60k liability. If downtime hits 8h (realistic variability), you miss 50k target and lose 60k. CFO impressed by guts, but you\'re gambling. Score: +15 (high stakes)'
                    },
                    {
                        letter: 'B',
                        text: 'Counter: Lower guarantee to 35k with 20% refund (safer math)',
                        impact: 'Balanced risk, still strong commitment',
                        next: 'turn4_balanced',
                        score: 25,
                        feedback: ' Smart negotiation! 35k target (vs 45k pilot) = 10k buffer. 20% refund = 40k max liability (manageable). CFO: "Fair compromise." You protected margin while showing confidence. Score: +25 (excellent)'
                    }
                ],
                type: 'choice'
            },
            turn3_noguarantee: {
                turnNumber: 3,
                speaker: { icon: '', name: 'Adam (Procurement)', role: 'Budget Guardian' },
                quote: '"No guarantee? Then you\'re just another vendor making promises. Bosch at least offers 3-year price lock. I\'m recommending we stay with Bosch unless you can match their 135k. Final answer: match or we\'re done here."',
                context: 'You\'re back to price war. No guarantee killed your value story. This is last chance.',
                options: [
                    {
                        letter: 'A',
                        text: 'Match 135k to save the deal',
                        impact: 'Deal closes but at 32% discount (terrible)',
                        next: 'ending_pricematch',
                        score: 10,
                        feedback: ' You matched Bosch. Deal closed at 135k (65k discount). No value sold, pure price. Quota hit, margin destroyed. This is why value selling matters. Score: +10. TOTAL: 20/100 - FAILED PATH'
                    },
                    {
                        letter: 'B',
                        text: 'Walk away - deal isn\'t worth 65k discount',
                        impact: 'Preserve brand, lose deal',
                        next: 'ending_walkaway',
                        score: 5,
                        feedback: ' You walked. Principle intact, but deal lost. Marek disappointed (he wanted Milwaukee). Lesson: Guarantee would\'ve changed outcome. Score: +5. TOTAL: 10/100 - FAILED PATH'
                    }
                ],
                type: 'choice'
            },
            turn4_champion: {
                turnNumber: 4,
                speaker: { icon: '', name: 'Zofia (CFO)', role: 'ROI Analyst' },
                quote: '"Marek makes a good point. 30k guaranteed savings Year 1, likely 40-45k actual. 13-month payback is solid. Adam, I know 200k feels expensive, but TCO math checks out. My only ask: Can we structure payment as Net 90 instead of Net 30? Cash flow timing."',
                context: 'CFO is SOLD on value. She\'s asking for payment terms (low-cost concession). This is closing moment.',
                options: [
                    {
                        letter: 'A',
                        text: 'Agree to Net 90: "Absolutely. 200k at Net 90 works for us."',
                        impact: 'Small concession, big goodwill',
                        next: 'turn5_close',
                        score: 25,
                        feedback: ' Perfect! Net 90 costs you ~1,600 PLN (finance cost), CFO perceives 6k value (working capital). Adam can\'t object (CFO approved). You\'re closing. Score: +25 (excellent closing)'
                    },
                    {
                        letter: 'B',
                        text: 'Counter: "Net 90 if you commit to 250k annual volume (upsell attempt)"',
                        impact: 'Greedy move, risks closing momentum',
                        next: 'turn5_greedy',
                        score: 5,
                        feedback: ' Greedy! CFO was ready to sign, you added condition. Adam: "See? Always upselling." Marek facepalms. You almost lost deal. Score: +5 (bad timing)'
                    }
                ],
                type: 'choice'
            },
            turn5_close: {
                turnNumber: 5,
                speaker: { icon: '', name: 'Adam (Procurement)', role: 'Budget Guardian' },
                quote: '(Sighs) "Fine. Zofia and Marek both want this. 200k at Net 90, 30k savings guarantee, 10% Year 2 credit if you miss. I\'ll draft the PO. But you better deliver on that downtime reduction, or I\'ll make sure you never sell here again."',
                context: 'Deal CLOSED! Adam grudgingly approved. You won through coalition (Marek + Zofia), data (TCO), and smart concessions (Net 90, conservative guarantee).',
                options: [
                    {
                        letter: 'A',
                        text: 'Assumptive close: "Perfect! I\'ll send contract today. Delivery in 3 weeks, training in Week 4?"',
                        impact: 'Professional close, move to implementation',
                        next: 'ending_perfect',
                        score: 20,
                        feedback: ' CLOSED! You moved to implementation immediately (assumptive close). Adam can\'t back out now. Marek smiles. CFO approves. 200k deal at target price, 30k savings guaranteed, client coalition built. Score: +20. TOTAL: 95/100 - MASTER NEGOTIATOR!'
                    }
                ],
                type: 'choice'
            },
            turn4_balanced: {
                turnNumber: 4,
                speaker: { icon: '', name: 'Marek (PM)', role: 'Your Ally' },
                quote: '"35k guarantee with 20% refund is fair, Zofia. And honestly, based on pilot, we\'ll hit 40k easy. I\'m comfortable with this. Adam, your concerns about price - I get it. But we\'re bleeding 15k/month in downtime. This is an investment, not an expense."',
                context: 'Marek is closing for you again. CFO nodded approval. Adam is last holdout.',
                options: [
                    {
                        letter: 'A',
                        text: 'Offer Adam small win: "Net 75 payment terms + quarterly reviews with you, Adam. Transparency."',
                        impact: 'Give Procurement visible concession',
                        next: 'turn5_diplomatic',
                        score: 25,
                        feedback: ' Brilliant! Net 75 costs you ~1k, Adam feels heard (QBRs = partnership). CFO and Marek already sold. Adam: "OK, I can support this." Coalition complete. Score: +25 (diplomatic mastery)'
                    },
                    {
                        letter: 'B',
                        text: 'Stay silent, let Marek and CFO pressure Adam',
                        impact: 'Let internal politics play out',
                        next: 'turn5_passive',
                        score: 15,
                        feedback: ' Passive. Adam feels outvoted, grudgingly agrees but resents you. Deal closes at 200k but Adam will be difficult partner. Score: +15 (won deal, lost ally)'
                    }
                ],
                type: 'choice'
            },
            turn5_diplomatic: {
                turnNumber: 5,
                speaker: { icon: '', name: 'Adam (Procurement)', role: 'Budget Guardian' },
                quote: '"Alright. Net 75, quarterly reviews, 35k guarantee. I can live with that. Zofia, you approve the budget. Marek, you own the implementation. I\'ll draft the PO for 200k. But I\'m watching those downtime numbers closely."',
                context: 'CLOSED! You won Adam over with small concessions. All 3 stakeholders aligned.',
                options: [
                    {
                        letter: 'A',
                        text: 'Thank everyone: "Appreciate the partnership. I\'ll deliver on every promise. Let\'s schedule kickoff next week."',
                        impact: 'Professional, builds long-term relationship',
                        next: 'ending_partnership',
                        score: 20,
                        feedback: ' PERFECT CLOSE! You built coalition (Marek + Zofia + Adam), sold value (TCO), managed risk (35k guarantee), and gave smart concessions (Net 75, QBRs). 200k at target, everyone feels like winner. Score: +20. TOTAL: 90/100 - MASTER PATH!'
                    }
                ],
                type: 'choice'
            },
            // ... (other paths lead to various endings with scores)
        };

        function startRoleplay() {
            roleplayState = { currentTurn: 'turn1', score: 0, path: [], ended: false };
            renderTurn(roleplayState.currentTurn);
        }

        function renderTurn(turnKey) {
            const turn = roleplayData[turnKey];
            if (!turn) {
                console.error('Turn not found:', turnKey);
                return;
            }

            const container = document.getElementById('roleplayContainer');
            
            const turnHTML = `
                <div class="conversation">
                    <div class="turn-header">
                        <div class="turn-number">Turn ${turn.turnNumber}/5</div>
                        <div class="current-score">Score: ${roleplayState.score}/100</div>
                    </div>

                    <div class="quote-bubble">
                        <div class="quote-speaker">
                            <span class="speaker-icon">${turn.speaker.icon}</span>
                            <div class="speaker-info">
                                <h4>${turn.speaker.name}</h4>
                                <p>${turn.speaker.role}</p>
                            </div>
                        </div>
                        <div class="quote-text">${turn.quote}</div>
                        ${turn.context ? `<div class="context-note"><strong> Context:</strong> ${turn.context}</div>` : ''}
                    </div>

                    <div class="choice-options" id="choices-${turnKey}">
                        ${turn.options.map((opt, idx) => `
                            <button class="choice-btn" onclick="selectChoice('${turnKey}', ${idx})">
                                <span class="choice-letter">${opt.letter}</span>
                                <div class="choice-content">
                                    <div class="choice-text">${opt.text}</div>
                                    <div class="choice-impact">${opt.impact}</div>
                                </div>
                            </button>
                        `).join('')}
                    </div>

                    <div class="turn-feedback" id="feedback-${turnKey}"></div>
                </div>
            `;

            container.innerHTML = turnHTML;
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function selectChoice(turnKey, choiceIdx) {
            const turn = roleplayData[turnKey];
            const choice = turn.options[choiceIdx];

            // Disable all choices
            const choicesContainer = document.getElementById(`choices-${turnKey}`);
            const buttons = choicesContainer.querySelectorAll('.choice-btn');
            buttons.forEach((btn, idx) => {
                btn.classList.add('disabled');
                if (idx === choiceIdx) {
                    btn.classList.add('selected');
                }
            });

            // Update score and path
            roleplayState.score += choice.score;
            roleplayState.path.push({
                turn: turn.turnNumber,
                choice: choice.letter,
                text: choice.text,
                score: choice.score
            });

            // Show feedback
            const feedbackDiv = document.getElementById(`feedback-${turnKey}`);
            feedbackDiv.innerHTML = `
                <h4>Your Choice: ${choice.letter}</h4>
                <p>${choice.feedback}</p>
                <span class="score-change">+${choice.score} points</span>
            `;
            feedbackDiv.classList.add('show');

            // Check if ending
            if (choice.next.startsWith('ending_')) {
                setTimeout(() => showEnding(choice.next), 1500);
            } else {
                // Show next turn button
                const nextBtn = document.createElement('button');
                nextBtn.className = 'next-turn-btn';
                nextBtn.textContent = 'Continue to Next Turn ';
                nextBtn.onclick = () => {
                    roleplayState.currentTurn = choice.next;
                    renderTurn(choice.next);
                };
                feedbackDiv.appendChild(nextBtn);
            }

            saveRoleplayState();
        }

        function showEnding(endingKey) {
            const endings = {
                ending_perfect: {
                    score: 95,
                    grade: 'excellent',
                    title: ' MASTER NEGOTIATOR',
                    message: 'You closed 200k deal at TARGET PRICE through:<br> Value selling (TCO vs price)<br> Coalition building (Marek + Zofia allies)<br> Conservative guarantees (30-35k, manageable risk)<br> Smart concessions (Net 90, low cost/high value)<br> Assumptive close (moved to implementation)<br><br>Result: Client happy (all stakeholders aligned), you happy (full margin), partnership established (Adam respects you). This is TOP 10% KAM performance.',
                    pathSummary: 'Perfect Path: TCO positioning  Conservative guarantee  Coalition leverage  Small concessions  Assumptive close'
                },
                ending_partnership: {
                    score: 90,
                    grade: 'excellent',
                    title: ' PARTNERSHIP PATH',
                    message: 'You closed 200k deal with ALL stakeholders as partners:<br> Adam: Won over with Net 75 + QBRs (felt heard)<br> Zofia: Sold on ROI + conservative guarantee<br> Marek: Championed you internally with your data<br><br>Result: Not just a sale, but a RELATIONSHIP. Renewal rate for this approach: 85%. You\'ll grow this account to 300k+ in Year 2.',
                    pathSummary: 'Diplomatic Path: TCO + Balanced guarantee + Coalition + Adam concession  Full alignment'
                },
                ending_lowmargin: {
                    score: 15,
                    grade: 'weak',
                    title: ' LOW MARGIN CLOSE',
                    message: 'You closed deal at 150k (25% discount, 50k margin loss):<br> Gave 15% in first turn (showed weakness)<br> Adam pushed for more (you caved again)<br> CFO never engaged (no value discussion)<br> Marek disappointed (wanted you to fight)<br><br>Result: Quota hit, but at what cost? You left 50k on table. Next deal, they\'ll expect same discount. Race to bottom.',
                    pathSummary: 'Failed Path: Instant discount  More discount  Price capitulation'
                },
                ending_walkaway: {
                    score: 10,
                    grade: 'weak',
                    title: ' DEAL LOST',
                    message: 'You walked away on principle (no guarantee, wouldn\'t match Bosch):<br> Brand integrity intact (didn\'t discount to 135k)<br> Deal lost (Bosch renewed at 135k)<br> Marek frustrated (he wanted Milwaukee)<br><br>Lesson: A conservative guarantee (30k) would\'ve changed outcome. Walking away is noble, but selling value is better.',
                    pathSummary: 'Failed Path: No guarantee  Price war  Walk away'
                }
            };

            const ending = endings[endingKey] || endings.ending_walkaway;
            const finalScore = roleplayState.score;

            const endDiv = document.getElementById('roleplayEnd');
            endDiv.innerHTML = `
                <div class="final-score ${ending.grade}">${finalScore}/100</div>
                <div class="score-label">${ending.title}</div>
                
                <div class="outcome-message">${ending.message}</div>

                <div class="path-review">
                    <h4> Your Path:</h4>
                    ${roleplayState.path.map(step => `
                        <div class="path-step">
                            <strong>Turn ${step.turn} - Choice ${step.choice}:</strong> ${step.text} <span class="score-change">+${step.score}</span>
                        </div>
                    `).join('')}
                    <div class="path-step" style="margin-top: 20px; border-color: #4CAF50;">
                        <strong> ${ending.pathSummary}</strong>
                    </div>
                </div>
            `;

            endDiv.classList.add('show');
            endDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Award XP (only once)
            if (!completedCards.has(8)) {
                completedCards.add(8);
                earnedXP += cardXPValues[8];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('roleplaySuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }
        }

        function saveRoleplayState() {
            localStorage.setItem('roleplayState', JSON.stringify(roleplayState));
        }

        function loadRoleplayState() {
            const saved = localStorage.getItem('roleplayState');
            if (saved) {
                roleplayState = JSON.parse(saved);
                if (roleplayState.ended) {
                    // Show ending if already completed
                    showEnding(roleplayState.endingKey || 'ending_walkaway');
                } else if (roleplayState.currentTurn) {
                    renderTurn(roleplayState.currentTurn);
                } else {
                    startRoleplay();
                }
            } else {
                startRoleplay();
            }
        }

        // ===== Card 7: Objection Handling Flashcards Functions =====
        let flippedObjectionCards = new Set();

        function flipObjectionCard(index) {
            const flashcard = document.getElementById(`objection${index}`);
            flashcard.classList.toggle('flipped');
            
            // Track flipped cards
            if (flashcard.classList.contains('flipped')) {
                flippedObjectionCards.add(index);
            }
            
            updateObjectionProgress();
        }

        function updateObjectionProgress() {
            const progressText = document.getElementById('objectionProgress');
            progressText.textContent = `${flippedObjectionCards.size}/6`;
            
            // Award XP when all 6 viewed
            if (flippedObjectionCards.size === 6 && !completedCards.has(7)) {
                completedCards.add(7);
                earnedXP += cardXPValues[7];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('objectionSuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }

            // Save to localStorage
            localStorage.setItem('flippedObjectionCards', JSON.stringify(Array.from(flippedObjectionCards)));
        }

        function markAllObjectionsKnown() {
            for (let i = 0; i < 6; i++) {
                const flashcard = document.getElementById(`objection${i}`);
                if (!flashcard.classList.contains('flipped')) {
                    flashcard.classList.add('flipped');
                }
                flippedObjectionCards.add(i);
            }
            updateObjectionProgress();
        }

        function resetObjectionCards() {
            for (let i = 0; i < 6; i++) {
                const flashcard = document.getElementById(`objection${i}`);
                flashcard.classList.remove('flipped');
            }
            flippedObjectionCards.clear();
            updateObjectionProgress();
        }

        // ===== Card 6: Contract Negotiation Functions =====
        function calculateContractBalance() {
            const terms = ['payment', 'volume', 'price', 'exclusive', 'delivery', 'warranty', 'termination', 'performance', 'ip', 'renewal'];
            
            let clientCount = 0;
            let neutralCount = 0;
            let vendorCount = 0;

            terms.forEach(term => {
                const selected = document.querySelector(`input[name="${term}"]:checked`);
                if (selected) {
                    const value = selected.value;
                    if (value === 'client') clientCount++;
                    else if (value === 'neutral') neutralCount++;
                    else if (value === 'vendor') vendorCount++;
                }
            });

            // Update displays
            document.getElementById('clientScore').textContent = clientCount;
            document.getElementById('neutralScore').textContent = neutralCount;
            document.getElementById('vendorScore').textContent = vendorCount;

            // Interpretation
            const balanceText = document.getElementById('balanceText');
            let interpretation = '';

            if (clientCount + neutralCount + vendorCount < 10) {
                interpretation = 'Wypenij wszystkie 10 terminw aby zobaczy peny balance score.';
            } else {
                const clientPercent = (clientCount / 10) * 100;
                
                if (clientCount >= 4 && clientCount <= 6 && vendorCount >= 1 && vendorCount <= 3) {
                    interpretation = ' <strong>Perfect Balance!</strong> Client czuje si winner (4-6 favorable terms), ale Ty chronisz margin (vendor terms w key areas). Partnership feeling = high renewal rate. Good negotiation!';
                } else if (clientCount >= 7) {
                    interpretation = ' <strong>Too Client-Heavy.</strong> Client happy, ale Ty zostawiasz margin na stole. Re-think: ktre vendor terms s critical dla Ciebie? (np. price, warranty, performance). Trade low-cost concessions (payment, data), nie wszystko.';
                } else if (vendorCount >= 5) {
                    interpretation = ' <strong>Too Vendor-Heavy.</strong> Ty wygrywasz wszystko = client feels squeezed. Risk: Procurement blockuje deal lub re-negotiates aggressively Year 2. Soften 2-3 terms (payment Net 60, flexible termination) = goodwill.';
                } else if (neutralCount >= 7) {
                    interpretation = ' <strong>Too Neutral.</strong> Safe, ale no differentiation. Client nie czuje win. Pick 2-3 terms to give client victory (visible wins) + 2 terms for you (invisible protection). Balanced  all neutral.';
                } else {
                    interpretation = ' <strong>Mixed.</strong> Review your priorities: Ktre terms s must-win dla Ciebie? Ktre moesz da client? Aim: Client wins visible (payment, termination), you win invisible (price lock, conservative guarantees).';
                }
            }

            balanceText.innerHTML = interpretation;

            // Save to localStorage
            saveContractData();
        }

        function saveContractData() {
            const terms = ['payment', 'volume', 'price', 'exclusive', 'delivery', 'warranty', 'termination', 'performance', 'ip', 'renewal'];
            const data = {};

            terms.forEach(term => {
                const selected = document.querySelector(`input[name="${term}"]:checked`);
                if (selected) {
                    data[term] = selected.value;
                }

                // Save notes
                const noteIndex = terms.indexOf(term) + 1;
                const notes = document.getElementById(`notes${noteIndex}`);
                if (notes) {
                    data[`notes${noteIndex}`] = notes.value;
                }
            });

            localStorage.setItem('contractData', JSON.stringify(data));
        }

        function loadContractData() {
            const saved = localStorage.getItem('contractData');
            if (saved) {
                const data = JSON.parse(saved);
                
                // Restore radio selections
                Object.keys(data).forEach(key => {
                    if (key.startsWith('notes')) {
                        const textarea = document.getElementById(key);
                        if (textarea) textarea.value = data[key];
                    } else {
                        const radio = document.querySelector(`input[name="${key}"][value="${data[key]}"]`);
                        if (radio) radio.checked = true;
                    }
                });

                calculateContractBalance();
            }
        }

        function saveContract() {
            const terms = ['payment', 'volume', 'price', 'exclusive', 'delivery', 'warranty', 'termination', 'performance', 'ip', 'renewal'];
            const allSelected = terms.every(term => document.querySelector(`input[name="${term}"]:checked`));

            if (!allSelected) {
                alert(' Wypenij wszystkie 10 terminw przed zapisaniem!');
                return;
            }

            // Award XP (only once)
            if (!completedCards.has(6)) {
                completedCards.add(6);
                earnedXP += cardXPValues[6];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('contractSuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }
        }

        // ===== Card 5: Closing Techniques Flashcards Functions =====
        let flippedClosingCards = new Set();

        function flipClosingCard(index) {
            const flashcard = document.getElementById(`flashcard${index}`);
            flashcard.classList.toggle('flipped');
            
            // Track flipped cards
            if (flashcard.classList.contains('flipped')) {
                flippedClosingCards.add(index);
            }
            
            updateClosingProgress();
        }

        function updateClosingProgress() {
            const progressText = document.getElementById('closingProgress');
            progressText.textContent = `${flippedClosingCards.size}/5`;
            
            // Award XP when all 5 viewed
            if (flippedClosingCards.size === 5 && !completedCards.has(5)) {
                completedCards.add(5);
                earnedXP += cardXPValues[5];
                updateProgress();
                saveProgress();
                
                const successMsg = document.getElementById('closingSuccess');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            }

            // Save to localStorage
            localStorage.setItem('flippedClosingCards', JSON.stringify(Array.from(flippedClosingCards)));
        }

        function markAllClosingKnown() {
            for (let i = 0; i < 5; i++) {
                const flashcard = document.getElementById(`flashcard${i}`);
                if (!flashcard.classList.contains('flipped')) {
                    flashcard.classList.add('flipped');
                }
                flippedClosingCards.add(i);
            }
            updateClosingProgress();
        }

        function resetClosingCards() {
            for (let i = 0; i < 5; i++) {
                const flashcard = document.getElementById(`flashcard${i}`);
                flashcard.classList.remove('flipped');
            }
            flippedClosingCards.clear();
            updateClosingProgress();
        }

        // Initialize Card 3 & 4 & 5 on load
        window.addEventListener('DOMContentLoaded', () => {
            // ... existing code ...
            
            // Render scenarios
            renderScenarios();

            // Restore value stack selections
            const savedSelections = localStorage.getItem('valueStackSelections');
            if (savedSelections) {
                const selections = JSON.parse(savedSelections);
                selections.forEach((checked, idx) => {
                    document.getElementById(`value${idx}`).checked = checked;
                });
                calculateValueStack();
            }

            // Restore closing flashcards state
            const savedFlippedClosing = localStorage.getItem('flippedClosingCards');
            if (savedFlippedClosing) {
                const flipped = JSON.parse(savedFlippedClosing);
                flipped.forEach(idx => {
                    flippedClosingCards.add(idx);
                    document.getElementById(`flashcard${idx}`).classList.add('flipped');
                });
                updateClosingProgress();
            }

            // Load contract data and attach listeners
            loadContractData();
            
            const terms = ['payment', 'volume', 'price', 'exclusive', 'delivery', 'warranty', 'termination', 'performance', 'ip', 'renewal'];
            terms.forEach(term => {
                const radios = document.querySelectorAll(`input[name="${term}"]`);
                radios.forEach(radio => {
                    radio.addEventListener('change', calculateContractBalance);
                });
            });

            // Restore objection flashcards state
            const savedFlippedObjections = localStorage.getItem('flippedObjectionCards');
            if (savedFlippedObjections) {
                const flipped = JSON.parse(savedFlippedObjections);
                flipped.forEach(idx => {
                    flippedObjectionCards.add(idx);
                    document.getElementById(`objection${idx}`).classList.add('flipped');
                });
                updateObjectionProgress();
            }

            // Card 9: Load checklist and email builder state
            loadChecklistState();
            loadEmailBuilderState();
        });
    </script>
</body>
</html>