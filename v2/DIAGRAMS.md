# BVA v2 - Diagramy Techniczne & PrzepÅ‚ywy

## ðŸ“ Spis TreÅ›ci
1. [Architektura Systemu](#architektura-systemu)
2. [Database Schema (Visual)](#database-schema)
3. [Authentication Flow](#authentication-flow)
4. [Lesson Workflow](#lesson-workflow)
5. [State Management](#state-management)
6. [Folder Structure](#folder-structure)

---

## ðŸ—ï¸ Architektura Systemu (SzczegÃ³Å‚owa)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT (Browser)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Next.js Application                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   Pages     â”‚ Components  â”‚  Services   â”‚    Hooks     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚             â”‚             â”‚             â”‚              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /login      â”‚ LoginForm   â”‚ api.ts      â”‚ useAuth()    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /dashboard  â”‚ StatsCard   â”‚ auth.ts     â”‚ useLessons() â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /lessons    â”‚ LessonCard  â”‚ storage.ts  â”‚ useProgress()â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /lessons/id â”‚ VideoPlayer â”‚             â”‚              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /profile    â”‚ ProfileForm â”‚             â”‚              â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  State Management: React Context + localStorage              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTPS REST API
                             â”‚ JSON payloads
                             â”‚ JWT Bearer Token
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVER (FastAPI)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     API Layer                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ auth.py  â”‚users.py  â”‚lessons.pyâ”‚progress  â”‚middleware  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          â”‚          â”‚          â”‚          â”‚            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ POST     â”‚ GET      â”‚ GET      â”‚ POST     â”‚ CORS       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /login   â”‚ /me      â”‚ /lessons â”‚ /start   â”‚ JWT Auth   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ /refresh â”‚ /stats   â”‚ /{id}    â”‚ /update  â”‚ Errors     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Business Logic Layer                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ UserService  â”‚LessonService â”‚ProgressService        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚              â”‚              â”‚                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ authenticate â”‚ get_lessons  â”‚ calculate_progress    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ create_token â”‚ get_by_id    â”‚ award_xp              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ verify_token â”‚ filter       â”‚ check_level_up        â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       ORM Layer (SQLAlchemy)                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚User Modelâ”‚Lesson    â”‚LessonProgressâ”‚ ActivityLog     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚          â”‚Model     â”‚Model         â”‚ Model           â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ SQL Queries
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE (SQLite)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  users   â”‚ lessons  â”‚lesson_progressâ”‚ activity_logs  â”‚          â”‚
â”‚  â”‚          â”‚          â”‚              â”‚                â”‚          â”‚
â”‚  â”‚ id       â”‚ id       â”‚ id           â”‚ id             â”‚          â”‚
â”‚  â”‚ username â”‚ title    â”‚ user_id      â”‚ user_id        â”‚          â”‚
â”‚  â”‚ password â”‚ video_urlâ”‚ lesson_id    â”‚ action_type    â”‚          â”‚
â”‚  â”‚ xp       â”‚ xp_rewardâ”‚ progress_%   â”‚ timestamp      â”‚          â”‚
â”‚  â”‚ level    â”‚ duration â”‚ completed_at â”‚ metadata       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                     â”‚
â”‚  File: bva_v2.db (production) / bva_test.db (testing)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ’¾ Database Schema (Detailed ERD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              USERS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ”‘ id                    INTEGER PK      â”‚
â”‚    user_id               VARCHAR(36)     â”‚â—„â”€â”€â”€â”€â”
â”‚ ðŸ”’ username              VARCHAR(50) UQ  â”‚     â”‚
â”‚ ðŸ”’ password_hash         VARCHAR(255)    â”‚     â”‚
â”‚ ðŸ“§ email                 VARCHAR(100) UQ â”‚     â”‚
â”‚    full_name             VARCHAR(100)    â”‚     â”‚
â”‚ â­ xp                    INTEGER â‰¥0      â”‚     â”‚
â”‚ ðŸ“Š level                 INTEGER â‰¥1      â”‚     â”‚
â”‚ ðŸ’Ž degencoins            INTEGER â‰¥0      â”‚     â”‚
â”‚    degen_type            VARCHAR(50)     â”‚     â”‚
â”‚ ðŸ¢ company               VARCHAR(100)    â”‚     â”‚
â”‚ ðŸ–¼ï¸  avatar_url            VARCHAR(255)    â”‚     â”‚
â”‚ âš™ï¸  preferences           JSON            â”‚     â”‚
â”‚ ðŸ” permissions           JSON            â”‚     â”‚
â”‚    account_created_by    VARCHAR(100)    â”‚     â”‚
â”‚ ðŸ“… joined_date           DATE            â”‚     â”‚
â”‚ ðŸ• last_login            DATETIME        â”‚     â”‚
â”‚ âœ… test_taken            BOOLEAN         â”‚     â”‚
â”‚ âœ… intro_completed       BOOLEAN         â”‚     â”‚
â”‚ ðŸ• created_at            DATETIME        â”‚     â”‚
â”‚ ðŸ• updated_at            DATETIME        â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                                  â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 â”‚                                â”‚
                 â”‚ 1:N                            â”‚ 1:N
                 â”‚                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      LESSON_PROGRESS              â”‚  â”‚     ACTIVITY_LOGS          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ”‘ id              INTEGER PK     â”‚  â”‚ ðŸ”‘ id          INTEGER PK  â”‚
â”‚ ðŸ”— user_id         INTEGER FK â”€â”€â”€â”€â”¼â”€â”€â”¼â”€ðŸ”— user_id     INTEGER FK  â”‚
â”‚ ðŸ”— lesson_id       VARCHAR FK     â”‚  â”‚    action_type VARCHAR(50) â”‚
â”‚ ðŸ“Š status          ENUM           â”‚  â”‚    description TEXT        â”‚
â”‚    â€¢ not_started                  â”‚  â”‚    metadata    JSON        â”‚
â”‚    â€¢ in_progress                  â”‚  â”‚ ðŸ• timestamp   DATETIME    â”‚
â”‚    â€¢ completed                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ðŸ“ˆ progress_percent INTEGER 0-100 â”‚
â”‚ â±ï¸  time_spent      INTEGER       â”‚
â”‚ â¯ï¸  last_position   INTEGER       â”‚
â”‚ ðŸ• started_at       DATETIME      â”‚
â”‚ âœ… completed_at     DATETIME      â”‚
â”‚ ðŸ• updated_at       DATETIME      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ N:1
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          LESSONS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ”‘ id              VARCHAR PK     â”‚
â”‚    title           VARCHAR(200)   â”‚
â”‚    description     TEXT           â”‚
â”‚    category        VARCHAR(100)   â”‚
â”‚ ðŸŽ¥ video_url       VARCHAR(500)   â”‚
â”‚ ðŸ–¼ï¸  thumbnail_url   VARCHAR(500)   â”‚
â”‚ â±ï¸  duration        INTEGER        â”‚
â”‚ â­ xp_reward       INTEGER        â”‚
â”‚ ðŸ“Š difficulty      ENUM           â”‚
â”‚    â€¢ Beginner                     â”‚
â”‚    â€¢ Intermediate                 â”‚
â”‚    â€¢ Advanced                     â”‚
â”‚    â€¢ Expert                       â”‚
â”‚ ðŸ”¢ order           INTEGER        â”‚
â”‚ âœ… is_published    BOOLEAN        â”‚
â”‚ ðŸ• created_at      DATETIME       â”‚
â”‚ ðŸ• updated_at      DATETIME       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INDEXES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
users.username (UNIQUE)
users.email (UNIQUE)
lesson_progress.user_id
lesson_progress.lesson_id
lesson_progress.status
activity_logs.user_id
activity_logs.timestamp
lessons.category
lessons.difficulty
lessons.order

CONSTRAINTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
users.xp >= 0
users.level >= 1
lesson_progress.progress_percent BETWEEN 0 AND 100
lessons.duration > 0
lessons.xp_reward >= 0
```

---

## ðŸ” Authentication Flow (SzczegÃ³Å‚owy)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND   â”‚
â”‚  /login     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. User enters credentials
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate form                â”‚
â”‚ â€¢ Username not empty         â”‚
â”‚ â€¢ Password min 6 chars       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. POST /auth/login
       â”‚    {username, password}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                     â”‚
â”‚  auth.login_for_access_token â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Query database
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User = db.query(User)        â”‚
â”‚   .filter(username=X)        â”‚
â”‚   .first()                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User     â”‚
    â”‚ exists?  â”‚
    â””â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚   â”‚
    NO â”‚   â”‚ YES
       â”‚   â”‚
       â–¼   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Raise 401    â”‚  â”‚ Verify password      â”‚
    â”‚ Unauthorized â”‚  â”‚ bcrypt.checkpw()     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Password   â”‚
                          â”‚ valid?     â”‚
                          â””â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                          NO â”‚    â”‚ YES
                             â”‚    â”‚
                             â–¼    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Raise 401    â”‚  â”‚ Generate JWT token    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ {                     â”‚
                                      â”‚   sub: username,      â”‚
                                      â”‚   exp: now + 30min    â”‚
                                      â”‚ }                     â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â”‚ 4. Return token
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Response {          â”‚
                                    â”‚   access_token: JWT â”‚
                                    â”‚   token_type: bearerâ”‚
                                    â”‚   user: {...}       â”‚
                                    â”‚ }                   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â”‚ 5. Store token
                                           â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ FRONTEND                    â”‚
                              â”‚ localStorage.setItem(       â”‚
                              â”‚   'auth_token', JWT         â”‚
                              â”‚ )                           â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ 6. Redirect to /dashboard
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Every API request includes: â”‚
                            â”‚ Authorization: Bearer JWT   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SUBSEQUENT REQUESTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Request â†’ Middleware checks JWT â†’ Extract username â†’ Load user â†’ Allow/Deny

Token expiry handling:
â€¢ Token expires after 30 min
â€¢ Frontend detects 401 on any request
â€¢ Prompts re-login
â€¢ (Future: Refresh token flow)
```

---

## ðŸ“š Lesson Workflow (Complete)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER JOURNEY                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard            â”‚
â”‚ "PrzeglÄ…daj lekcje" â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /lessons?category=all&status=all
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Fetch lessons + user's progress                â”‚
â”‚                                                          â”‚
â”‚ SELECT l.*, lp.status, lp.progress_percent              â”‚
â”‚ FROM lessons l                                           â”‚
â”‚ LEFT JOIN lesson_progress lp                            â”‚
â”‚   ON l.id = lp.lesson_id AND lp.user_id = :current_userâ”‚
â”‚ WHERE l.is_published = TRUE                             â”‚
â”‚ ORDER BY l.category, l.order                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Response: [{lesson, my_progress}, ...]
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LESSONS PAGE                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚Lesson 1â”‚ â”‚Lesson 2â”‚ â”‚Lesson 3â”‚        â”‚
â”‚ â”‚  âœ…    â”‚ â”‚  45%   â”‚ â”‚  NEW   â”‚        â”‚
â”‚ â”‚ 50 XP  â”‚ â”‚ 150 XP â”‚ â”‚ 100 XP â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                          â”‚
â”‚ Filters: [Kategoria â–¼] [Difficulty â–¼]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ User clicks Lesson 2
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /lessons/strat-1                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Fetch lesson details + user's progress     â”‚
â”‚                                                      â”‚
â”‚ lesson = db.query(Lesson).filter(id='strat-1')      â”‚
â”‚ progress = db.query(LessonProgress)                 â”‚
â”‚   .filter(user_id=X, lesson_id='strat-1')           â”‚
â”‚   .first()                                           â”‚
â”‚                                                      â”‚
â”‚ if not progress:                                     â”‚
â”‚   progress = LessonProgress(                        â”‚
â”‚     user_id=X,                                       â”‚
â”‚     lesson_id='strat-1',                            â”‚
â”‚     status='not_started'                            â”‚
â”‚   )                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LESSON PLAYER PAGE                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  Video Player                                  â”‚  â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚ â”‚  â”‚  â–¶ï¸  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 12:30   â”‚ â”‚  â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â”‚  Resume from: 5:30                             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚ ðŸ“ Strategia BÅ‚Ä™kitnego Oceanu                      â”‚
â”‚ â±ï¸  15 min  â”‚  â­ 150 XP  â”‚  ðŸ“Š Intermediate       â”‚
â”‚                                                      â”‚
â”‚ Opis: Jak unikaÄ‡ konkurencji...                     â”‚
â”‚                                                      â”‚
â”‚ Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60%                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Every 30 seconds during playback
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PUT /lessons/strat-1/progress                        â”‚
â”‚ {                                                    â”‚
â”‚   progress_percent: 65,                              â”‚
â”‚   last_position: 390,  // seconds                   â”‚
â”‚   time_spent: 780      // total seconds watched     â”‚
â”‚ }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Update progress                             â”‚
â”‚                                                      â”‚
â”‚ progress.progress_percent = 65                       â”‚
â”‚ progress.last_position = 390                         â”‚
â”‚ progress.time_spent = 780                            â”‚
â”‚ progress.status = 'in_progress'                      â”‚
â”‚ progress.updated_at = now()                          â”‚
â”‚ db.commit()                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User reaches 100%
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /lessons/strat-1/complete                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Complete lesson workflow                    â”‚
â”‚                                                      â”‚
â”‚ 1. Update progress                                   â”‚
â”‚    progress.status = 'completed'                     â”‚
â”‚    progress.completed_at = now()                     â”‚
â”‚    progress.progress_percent = 100                   â”‚
â”‚                                                      â”‚
â”‚ 2. Award XP                                          â”‚
â”‚    user.xp += lesson.xp_reward (150)                â”‚
â”‚    new_xp = user.xp                                  â”‚
â”‚                                                      â”‚
â”‚ 3. Check level up                                    â”‚
â”‚    old_level = user.level                            â”‚
â”‚    new_level = calculate_level(new_xp)              â”‚
â”‚    if new_level > old_level:                         â”‚
â”‚      user.level = new_level                          â”‚
â”‚      leveled_up = True                               â”‚
â”‚                                                      â”‚
â”‚ 4. Log activity                                      â”‚
â”‚    ActivityLog.create({                              â”‚
â”‚      user_id: X,                                     â”‚
â”‚      action_type: 'lesson_completed',               â”‚
â”‚      description: 'Completed: Strategia...',        â”‚
â”‚      metadata: {lesson_id, xp_gained}               â”‚
â”‚    })                                                â”‚
â”‚                                                      â”‚
â”‚ 5. Return result                                     â”‚
â”‚    {                                                 â”‚
â”‚      xp_gained: 150,                                 â”‚
â”‚      total_xp: 1200,                                 â”‚
â”‚      new_level: 3,                                   â”‚
â”‚      leveled_up: True                                â”‚
â”‚    }                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: Show celebration                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚  ðŸŽ‰ Gratulacje!                               â”‚    â”‚
â”‚ â”‚                                               â”‚    â”‚
â”‚ â”‚  UkoÅ„czyÅ‚eÅ› lekcjÄ™!                          â”‚    â”‚
â”‚ â”‚  +150 XP                                      â”‚    â”‚
â”‚ â”‚                                               â”‚    â”‚
â”‚ â”‚  ðŸŽŠ LEVEL UP! JesteÅ› teraz Level 3! ðŸŽŠ       â”‚    â”‚
â”‚ â”‚                                               â”‚    â”‚
â”‚ â”‚  [ NastÄ™pna lekcja â†’ ]                        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

XP â†’ Level Calculation:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Level 1:     0 -   99 XP
Level 2:   100 -  299 XP
Level 3:   300 -  599 XP
Level 4:   600 -  999 XP
Level 5:  1000 - 1499 XP
Level 6:  1500 - 2099 XP
...
Formula: next_threshold = current_threshold + (level * 100)
```

---

## ðŸ—‚ï¸ Folder Structure (Kompletna)

```
BVA/
â”œâ”€â”€ v2/
â”‚   â”œâ”€â”€ backend/                    # FastAPI Backend
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ main.py             # FastAPI app instance
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py           # Pydantic Settings (env vars)
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py         # SQLAlchemy setup
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ models/             # SQLAlchemy Models
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.py         # User model
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lesson.py       # Lesson model
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ progress.py     # LessonProgress model
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ activity.py     # ActivityLog model
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas/            # Pydantic Schemas (request/response)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.py         # UserCreate, UserResponse, etc.
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lesson.py       # LessonResponse, LessonList, etc.
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ progress.py     # ProgressUpdate, ProgressResponse
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth.py         # Token, LoginRequest
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ api/                # API Routes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py         # POST /login, /refresh, /logout
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users.py        # GET /me, PUT /me, /stats
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lessons.py      # GET /lessons, /{id}, /progress
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ deps.py         # Dependencies (get_db, get_current_user)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ core/               # Core utilities
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ security.py     # JWT, password hashing
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.py       # Settings
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ services/           # Business Logic
â”‚   â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚       â”‚   â”œâ”€â”€ user_service.py     # User operations
â”‚   â”‚       â”‚   â”œâ”€â”€ lesson_service.py   # Lesson operations
â”‚   â”‚       â”‚   â””â”€â”€ progress_service.py # Progress/XP logic
â”‚   â”‚       â”‚
â”‚   â”‚   â”œâ”€â”€ alembic/                # Database Migrations
â”‚   â”‚   â”‚   â”œâ”€â”€ versions/
â”‚   â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â”‚   â””â”€â”€ alembic.ini
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tests/                  # Tests
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_lessons.py
â”‚   â”‚   â”‚   â””â”€â”€ conftest.py         # Pytest fixtures
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ scripts/                # Utility scripts
â”‚   â”‚   â”‚   â”œâ”€â”€ seed_data.py        # Seed lessons
â”‚   â”‚   â”‚   â””â”€â”€ migrate_users.py    # Migrate from JSON
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ requirements.txt        # Python dependencies
â”‚   â”‚   â”œâ”€â”€ .env                    # Environment variables
â”‚   â”‚   â”œâ”€â”€ .env.example
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ frontend/                   # Next.js Frontend
â”‚   â”‚   â”œâ”€â”€ app/                    # App Router (Next.js 15)
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/             # Auth layout group
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/        # Dashboard layout group
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx      # Sidebar + Nav
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # Dashboard home
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lessons/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx    # Lesson list
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx # Lesson player
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx          # Root layout
â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css         # Global styles
â”‚   â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/             # React Components
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                 # UI primitives
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Progress.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Badge.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ lessons/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LessonCard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LessonList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LessonPlayer.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LessonFilters.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StatsCard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ActivityFeed.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LevelProgress.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ layout/
â”‚   â”‚       â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚       â”‚   â””â”€â”€ MobileNav.tsx
â”‚   â”‚       â”‚
â”‚   â”‚   â”œâ”€â”€ lib/                    # Libraries & utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts              # Axios instance + API calls
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # Auth helpers (token, logout)
â”‚   â”‚   â”‚   â”œâ”€â”€ utils.ts            # Utility functions
â”‚   â”‚   â”‚   â””â”€â”€ constants.ts        # App constants
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hooks/                  # Custom React hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts          # Authentication hook
â”‚   â”‚   â”‚   â”œâ”€â”€ useLessons.ts       # Lessons data hook
â”‚   â”‚   â”‚   â””â”€â”€ useProgress.ts      # Progress tracking hook
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ context/                # React Context
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx     # Auth state
â”‚   â”‚   â”‚   â””â”€â”€ LayoutContext.tsx   # Layout preferences
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ types/                  # TypeScript types
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ lesson.ts
â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ public/                 # Static assets
â”‚   â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ logo.svg
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ lessons/
â”‚   â”‚   â”‚   â””â”€â”€ videos/             # (or external CDN)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ styles/                 # Additional styles
â”‚   â”‚   â”‚   â””â”€â”€ glassmorphism.css
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ middleware.ts           # Next.js middleware (auth)
â”‚   â”‚   â”œâ”€â”€ next.config.ts          # Next.js config
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts      # Tailwind config
â”‚   â”‚   â”œâ”€â”€ tsconfig.json           # TypeScript config
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                   # Shared database
â”‚   â”‚   â””â”€â”€ bva_v2.db               # SQLite file
â”‚   â”‚
â”‚   â”œâ”€â”€ docs/                       # Documentation
â”‚   â”‚   â”œâ”€â”€ API.md                  # API documentation
â”‚   â”‚   â”œâ”€â”€ DEPLOYMENT.md
â”‚   â”‚   â””â”€â”€ DEVELOPMENT.md
â”‚   â”‚
â”‚   â”œâ”€â”€ SPECIFICATION_MVP.md        # This file!
â”‚   â”œâ”€â”€ LAYOUT_PROPOSALS.md
â”‚   â”œâ”€â”€ DIAGRAMS.md                 # This file!
â”‚   â””â”€â”€ README.md                   # Main readme
â”‚
â”œâ”€â”€ main.py                         # Old Streamlit (to be deprecated)
â”œâ”€â”€ views/                          # Old Streamlit views
â”œâ”€â”€ utils/                          # Old utilities
â”œâ”€â”€ data/                           # Shared lesson data (JSON)
â”œâ”€â”€ users_data.json                 # OLD user storage
â””â”€â”€ users.db                        # SQLite (will migrate to v2/database/)
```

---

## ðŸ”„ State Management (Frontend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REACT CONTEXT API                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AuthContext
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
State:
â€¢ user: User | null
â€¢ token: string | null
â€¢ loading: boolean
â€¢ isAuthenticated: boolean

Actions:
â€¢ login(username, password)
â€¢ logout()
â€¢ refreshUser()
â€¢ updateProfile(data)

Storage:
â€¢ localStorage.auth_token (JWT)
â€¢ sessionStorage (optional, for session-only)

Usage:
const { user, login, logout } = useAuth();


LessonContext (Optional)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
State:
â€¢ lessons: Lesson[]
â€¢ currentLesson: Lesson | null
â€¢ filters: {category, difficulty, status}
â€¢ loading: boolean

Actions:
â€¢ fetchLessons()
â€¢ filterLessons(filters)
â€¢ setCurrentLesson(id)

Usage:
const { lessons, fetchLessons } = useLessons();


ProgressContext (Optional)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
State:
â€¢ currentProgress: Progress | null
â€¢ updating: boolean

Actions:
â€¢ updateProgress(lessonId, percent, position)
â€¢ completeLesson(lessonId)

Usage:
const { updateProgress, completeLesson } = useProgress();


Alternative: React Query / SWR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Automatic caching
â€¢ Background refetch
â€¢ Optimistic updates
â€¢ Better DevTools

Example:
const { data: lessons } = useQuery('lessons', fetchLessons);
```

---

## ðŸ“ File Examples

### Example: `backend/app/api/lessons.py`
```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List

from app.api.deps import get_db, get_current_user
from app.models.user import User
from app.models.lesson import Lesson
from app.models.progress import LessonProgress
from app.schemas.lesson import LessonResponse, LessonList
from app.services.lesson_service import LessonService

router = APIRouter(prefix="/lessons", tags=["lessons"])

@router.get("", response_model=List[LessonResponse])
async def get_lessons(
    category: str = None,
    difficulty: str = None,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Get all published lessons with user's progress"""
    service = LessonService(db)
    return service.get_lessons_with_progress(
        user_id=current_user.id,
        category=category,
        difficulty=difficulty
    )

@router.get("/{lesson_id}", response_model=LessonResponse)
async def get_lesson(
    lesson_id: str,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Get single lesson details"""
    service = LessonService(db)
    lesson = service.get_lesson_with_progress(
        lesson_id=lesson_id,
        user_id=current_user.id
    )
    if not lesson:
        raise HTTPException(status_code=404, detail="Lesson not found")
    return lesson
```

### Example: `frontend/hooks/useAuth.ts`
```typescript
import { createContext, useContext, useState, useEffect } from 'react';
import { api } from '@/lib/api';
import { User } from '@/types/user';

interface AuthContextType {
  user: User | null;
  token: string | null;
  loading: boolean;
  login: (username: string, password: string) => Promise<void>;
  logout: () => void;
  isAuthenticated: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }) {
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const storedToken = localStorage.getItem('auth_token');
    if (storedToken) {
      setToken(storedToken);
      fetchUser(storedToken);
    } else {
      setLoading(false);
    }
  }, []);

  const fetchUser = async (authToken: string) => {
    try {
      const userData = await api.getCurrentUser(authToken);
      setUser(userData);
    } catch (error) {
      localStorage.removeItem('auth_token');
      setToken(null);
    } finally {
      setLoading(false);
    }
  };

  const login = async (username: string, password: string) => {
    const response = await api.login(username, password);
    setToken(response.access_token);
    setUser(response.user);
    localStorage.setItem('auth_token', response.access_token);
  };

  const logout = () => {
    setUser(null);
    setToken(null);
    localStorage.removeItem('auth_token');
  };

  return (
    <AuthContext.Provider value={{
      user,
      token,
      loading,
      login,
      logout,
      isAuthenticated: !!token
    }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth must be used within AuthProvider');
  return context;
};
```

---

*Dokument techniczny - wersja 1.0*
*Ostatnia aktualizacja: 6 stycznia 2026*
